## 组件设计文档：SubscriptionListOverall

### 1. 概述

`SubscriptionListOverall.tsx` 文件包含三个核心 React 函数组件，用于展示和管理用户订阅列表：

- `SubscriptionItem`: 单个订阅项的展示和操作组件。
- `CDESubscriptionListOverall`: 订阅列表的整体展示组件，负责渲染多个 `SubscriptionItem`。
- `CDESubscriptionListOverallModal`: 将订阅列表嵌入到 Modal (对话框) 中展示的组件。

这些组件依赖 `@wind/wind-ui` 提供的 UI 组件，如 `Button`, `Empty`, `List`, `Modal`，并使用 `ahooks`库的 `useRequest` 来处理异步删除操作。

### 2. Props 定义

#### 2.1. `SubscriptionItemEvent` (Interface)

此接口定义了订阅项相关的事件回调和外部函数依赖。

| Prop Name             | Type                                                              | 描述                                           |
| :-------------------- | :---------------------------------------------------------------- | :--------------------------------------------- |
| `className`           | `string` (可选)                                                   | 自定义 CSS 类名。                              |
| `delSubFunc`          | `TRequestToWFCSpacfic<'operation/delete/deletesubcorpcriterion'>` | 删除订阅的异步函数。                           |
| `updateSubFunc`       | `TRequestToWFCSpacfic<'operation/update/updatesubcorpcriterion'>` | 更新订阅的异步函数。                           |
| `onClickApply`        | `(item: CDESubscribeItem) => void`                                | 点击"应用"按钮时的回调函数。                   |
| `getCDESubscribeText` | `(item: CDESubscribeItem) => string`                              | 根据订阅项数据生成描述文本的函数。             |
| `onRefresh`           | `() => void`                                                      | 操作（如删除、更新）成功后刷新列表的回调函数。 |

#### 2.2. `SubscriptionItemProps` (Interface)

继承自 `SubscriptionItemEvent`。

| Prop Name | Type                    | 描述             |
| :-------- | :---------------------- | :--------------- |
| `item`    | `CDESubscribeItem`      | 单个订阅项数据。 |
| ...       | `SubscriptionItemEvent` | 其他事件回调。   |

#### 2.3. `CDESubscriptionListOverall` Props

继承自 `SubscriptionItemEvent`。

| Prop Name        | Type                         | 描述                                        |
| :--------------- | :--------------------------- | :------------------------------------------ |
| `loading`        | `boolean` (可选)             | 列表是否处于加载状态。                      |
| `subEmail`       | `string \| undefined`        | 订阅关联的邮箱，会注入到每个 `item` 中。    |
| `subscribeList`  | `CDESubscribeItem[]`         | 订阅项数据列表。                            |
| `style`          | `React.CSSProperties` (可选) | 自定义列表容器样式。                        |
| `emptyClassName` | `string` (可选)              | 列表为空时 `Empty` 组件的自定义 CSS 类名。  |
| ...              | `SubscriptionItemEvent`      | 其他事件回调，会透传给 `SubscriptionItem`。 |

#### 2.4. `CDESubscriptionListOverallModal` Props

继承自 `SubscriptionItemEvent`。

| Prop Name       | Type                      | 描述                                                  |
| :-------------- | :------------------------ | :---------------------------------------------------- |
| `open`          | `boolean`                 | Modal 是否可见。                                      |
| `setOpen`       | `(open: boolean) => void` | 控制 Modal 可见性的回调函数。                         |
| `subEmail`      | `string`                  | 订阅关联的邮箱。                                      |
| `subscribeList` | `CDESubscribeItem[]`      | 订阅项数据列表。                                      |
| ...             | `SubscriptionItemEvent`   | 其他事件回调，会透传给 `CDESubscriptionListOverall`。 |

### 3. 主要功能点

#### 3.1. `SubscriptionItem`

- **展示订阅信息**: 显示订阅名称 (`item.subName`) 和通过 `getCDESubscribeText(item)` 生成的详细描述。
- **删除订阅**:
  - 点击"删除"按钮，调用 `delSubFunc` 并传入当前 `item`。
  - 处理删除操作的加载状态 (`delLoading`)。
  - 成功后，显示"删除成功"消息并调用 `onRefresh`。
  - 失败后，显示"删除失败"消息。
- **编辑订阅**:
  - 使用 `CDEUpdateSubButton` 组件进行编辑。
  - 传入 `item`, `updateSubFunc`, 和 `onRefresh` (作为 `onUpdateFinish` 回调)。
- **应用订阅**:
  - 点击"应用"按钮，调用 `onClickApply` 并传入当前 `item`。

#### 3.2. `CDESubscriptionListOverall`

- **列表渲染**:
  - 如果 `subscribeList` 为空或无效，显示 `Empty` 组件，提示"暂无保存内容"。
  - 否则，使用 `@wind/wind-ui` 的 `List` 组件渲染 `subscribeList`。
  - 为列表中的每个 `CDESubscribeItem`：
    - 将 `subEmail` prop 的值赋给 `item.subEmail`。
    - 渲染一个 `SubscriptionItem` 组件，并传入处理后的 `item` 和从父组件接收到的所有 `SubscriptionItemEvent` 相关的 props。
- **加载状态**: 支持 `loading` prop 来显示列表的加载状态。

#### 3.3. `CDESubscriptionListOverallModal`

- **Modal 展示**:
  - 使用 `@wind/wind-ui` 的 `Modal` 组件。
  - Modal 标题固定为"我的保存"。
  - Modal 的可见性由 `open` prop 控制。
  - 当用户尝试关闭 Modal (例如点击关闭按钮或遮罩层) 时，调用 `setOpen(false)`。
  - Modal 的底部操作栏被禁用 (`footer={false}`)。
- **内容嵌入**: 在 Modal 内部渲染 `CDESubscriptionListOverall` 组件，并将必要的 props (`subEmail`, `subscribeList`, 以及 `SubscriptionItemEvent` 相关的 props) 传递下去。

### 4. 流程图

#### 4.1. `SubscriptionItem` 组件操作流程

```mermaid
graph TD
    A[用户在某个订阅项上操作] --> B{选择操作类型};
    B -- 点击 '删除' --> C[调用 delSubFunc(item)];
    C --> D{API请求: 删除订阅};
    D -- 成功 --> E[显示 '删除成功' 消息];
    E --> F[调用 onRefresh()];
    D -- 失败 --> G[显示 '删除失败' 消息];
    B -- 点击 '编辑' --> H[渲染 CDEUpdateSubButton];
    H --> I[用户在 CDEUpdateSubButton 中修改并保存];
    I --> J[CDEUpdateSubButton 内部调用 updateSubFunc];
    J -- 更新成功 --> K[CDEUpdateSubButton 调用 onUpdateFinish (即 onRefresh)];
    B -- 点击 '应用' --> L[调用 onClickApply(item)];
```

#### 4.2. `CDESubscriptionListOverall` 组件渲染流程

```mermaid
graph TD
    A[CDESubscriptionListOverall 接收 props] --> B{subscribeList 是否为空或无效?};
    B -- 是 --> C[渲染 Empty 组件 (提示: 暂无保存内容)];
    B -- 否 --> D[渲染 List 组件 (dataSource=subscribeList, loading=loading)];
    D -- 对 subscribeList 中的每个 item --> E[创建副本 itemWithEmail = item];
    E --> F[设置 itemWithEmail.subEmail = subEmail];
    F --> G[渲染 <SubscriptionItem item={itemWithEmail} {...props} />];
```

#### 4.3. `CDESubscriptionListOverallModal` 组件交互流程

```mermaid
graph TD
    A[Modal 接收 props (open, setOpen, ...)] --> B{open === true?};
    B -- 是 --> C[显示 Modal (标题: '我的保存')];
    C --> D[在 Modal 内容区渲染 <CDESubscriptionListOverall {...props} />];
    D -- 用户与内部列表交互 --> E[遵循 CDESubscriptionListOverall 和 SubscriptionItem 流程];
    C -- 用户点击 Modal 关闭按钮或遮罩 --> F[调用 setOpen(false)];
    B -- 否 --> G[Modal 保持隐藏];
```

### 5. 使用示例 (概念性)

```tsx
// 假设在某个父组件中
import { CDESubscriptionListOverallModal } from './SubscriptionListOverall' // 假设路径
import { CDESubscribeItem } from 'gel-api'
import { useState } from 'react'

const MySubscriptionsPage = () => {
  const [isModalOpen, setIsModalOpen] = useState(false)
  const [mySubs, setMySubs] = useState<CDESubscribeItem[]>([
    // ... 示例订阅数据
    { subId: '1', subName: '我的第一个保存', subEmail: '', criterionContent: {} },
    { subId: '2', subName: '常用的搜索条件', subEmail: '', criterionContent: {} },
  ])
  const userEmail = 'user@example.com'

  const handleDeleteSubscription = async (item: CDESubscribeItem) => {
    console.log('尝试删除:', item.subId)
    // 实际的 API 调用
    // await api.deleteSub(item.subId);
    return Promise.resolve() // 假设成功
  }

  const handleUpdateSubscription = async (item: CDESubscribeItem, updatedData: any) => {
    console.log('尝试更新:', item.subId, '新数据:', updatedData)
    // 实际的 API 调用
    // await api.updateSub(item.subId, updatedData);
    return Promise.resolve() // 假设成功
  }

  const handleApplySubscription = (item: CDESubscribeItem) => {
    console.log('应用订阅:', item)
    // 执行应用逻辑
  }

  const getSubscriptionText = (item: CDESubscribeItem) => {
    return `订阅ID: ${item.subId}, 内容: ${JSON.stringify(item.criterionContent)}`
  }

  const refreshList = () => {
    console.log('刷新列表...')
    // 重新获取订阅列表的逻辑
    // setMySubs(await api.fetchSubs());
  }

  return (
    <div>
      <button onClick={() => setIsModalOpen(true)}>查看我的保存</button>
      <CDESubscriptionListOverallModal
        open={isModalOpen}
        setOpen={setIsModalOpen}
        subEmail={userEmail}
        subscribeList={mySubs}
        delSubFunc={handleDeleteSubscription as any} // 类型断言可能需要根据实际 TRequestToWFCSpacfic 调整
        updateSubFunc={handleUpdateSubscription as any} // 类型断言
        onClickApply={handleApplySubscription}
        getCDESubscribeText={getSubscriptionText}
        onRefresh={refreshList}
      />
    </div>
  )
}
```

