# 国际化 (i18n) 自动化工具使用指南

本工具集 (`scripts/i18n-suite`) 专为 Monorepo 项目设计，旨在自动化处理繁琐的国际化流程，包括代码扫描、词条替换、语言包生成及可视化报告输出。

---

## 📚 1. 核心功能

1.  **自动扫描与替换**:
    *   深度扫描项目 `src` 目录下的 `.js`, `.jsx`, `.ts`, `.tsx` 文件。
    *   **智能匹配**: 自动比对全局词库 (`packages/gel-util/src/intl/locales`)。
    *   **自动替换**:
        *   ✅ **已匹配**: 自动替换为标准格式 `t('namespace:id', '中文文案')`。
        *   ❌ **未匹配**: 替换为待处理格式 `t('', '中文文案')`，方便后续填补。
2.  **语言包生成**:
    *   根据代码中实际使用的 ID，自动生成/更新各子应用的 `zh-CN` 和 `en-US` JSON 文件。
    *   自动剔除未使用的废弃词条，保持语言包精简。
3.  **可视化报告**:
    *   生成交互式 HTML 报告，支持状态筛选、Excel 导出及“点击跳转编辑器”功能。

---

## 🚀 2. 快速开始

### 2.1 环境准备
确保项目依赖已安装，且 Node.js 环境正常。

### 2.2 运行命令
在项目根目录下执行：

#### 👉 推荐：处理单个项目
避免全量扫描，节省时间并减少误操作风险。
```bash
# 语法: node scripts/i18n-suite/run-batch.mjs <namespace>
node scripts/i18n-suite/run-batch.mjs superAgent
```

#### 批量处理所有项目
扫描 `i18n.config.mjs` 中配置的所有项目。
```bash
node scripts/i18n-suite/run-batch.mjs
```

---

## ⚙️ 3. 高级控制指令

为了应对复杂的开发场景，工具支持通过在**文件头部（前5行内）**添加注释指令来控制处理逻辑。

### 3.1 🚫 忽略文件 (`no intl`)
如果某个文件**完全不需要**国际化（如测试文件、Mock 数据、纯样式配置等），请添加：
```javascript
// no intl
```
*   **效果**: 工具将**完全跳过**该文件，不扫描也不修改。

### 3.2 🔒 锁定文件 (`intl done`)
如果某个文件已完成国际化，**不希望工具修改代码**（例如手动调整了换行或格式），但**仍需要工具识别其中的 ID** 以生成语言包，请添加：
```javascript
// intl done
```
*   **效果**:
    1.  **代码保护**: 工具**绝对不会修改**该文件的任何内容。
    2.  **ID 识别**: 工具仍会解析其中的 `t('id'...)` 调用，确保这些 ID 被包含在最终生成的语言包中。

---

## 📊 4. 国际化报告使用说明

脚本运行结束后，根目录下会生成 `i18n-report.html`。

### 4.1 报告功能
*   **状态概览**: 清晰展示“已匹配”与“未匹配”的词条数量。
*   **智能筛选**: 下拉框支持筛选：
    *   `全部`
    *   `已匹配`: ID 存在于全局词库中。
    *   `未匹配`: 代码中使用了中文但未找到对应 ID。
    *   `有推荐`: **(重点)** 未匹配词条中，系统在全局库中找到了相似或相同的文案，会给出推荐 ID。
*   **一键定位**: 点击“引用位置”链接，VS Code 会自动打开对应文件并定位到行（需保持终端服务运行）。
*   **数据导出**: 支持点击 **“导出 Excel”** 按钮，将当前筛选结果导出为 `.xlsx` 文件，便于分发给翻译人员。

---

## 🔧 5. 配置文件

配置文件路径: `scripts/i18n-suite/i18n.config.mjs`

```javascript
export const config = [
  {
    target: path.join(ROOT_DIR, 'apps/super-agent'), // 扫描目标目录
    locales: path.join(ROOT_DIR, 'packages/gel-util/src/locales/namespaces/superAgent'), // 语言包生成位置
    namespace: 'superAgent', // 命名空间 (用于 run-batch.mjs 参数)
  },
  // ... 其他项目配置
]
```

---

## ❓ 6. 常见问题 (FAQ)

**Q1: 为什么我的词条没有被生成到 JSON 文件中？**
*   **A**:
    1. 检查是否使用了 `// no intl` 指令。
    2. 如果使用了 `// intl done`，请确保代码中的 `t('id')` 调用格式正确。
    3. 检查文件是否在 `src` 目录下（工具强制只扫描 `src`）。

**Q2: 如何处理“未匹配”的词条？**
*   **A**:
    1. 查看报告中的“推荐词条”列，如果有推荐 ID，手动或批量替换代码。
    2. 如果是全新词条，请联系管理员将其添加到全局词库 (`packages/gel-util/src/intl/locales`)，然后重新运行脚本。

**Q3: 为什么点击报告中的链接无法打开编辑器？**
*   **A**: “跳转编辑器”功能依赖于脚本运行结束后启动的后台服务。请确保不要关闭运行脚本的终端窗口。如果服务已停止，只需重新运行脚本即可。
