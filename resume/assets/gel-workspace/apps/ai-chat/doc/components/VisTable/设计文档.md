# VisTable 操作处理系统设计文档

## 概述

VisTable 操作处理系统是一个用于统一管理和处理表格各种操作和事件的工具。它通过枚举定义操作类型，并提供了统一的操作处理接口，使用户可以方便地实现自定义操作处理逻辑，同时保留默认操作实现。

## 详细功能说明

该系统主要包含以下几个核心部分：

1. **操作类型枚举（OperationType）**：定义了所有支持的表格操作类型，包括数据操作、表格操作、事件处理等多个类别。

2. **操作值接口（OperationValue）**：定义了操作值的数据结构，用于传递操作相关的参数和数据。

3. **操作处理Hook（useOperationHandler）**：提供了统一的操作处理逻辑，支持用户自定义处理函数和默认处理逻辑。

4. **表格初始化与事件绑定**：在表格初始化过程中，将各种事件与操作处理函数关联，确保所有操作都能被正确处理。

### 工作流程

1. 用户可以通过 `onOperation` 参数向 VisTable 组件传递自定义的操作处理函数。
2. 如果用户提供了操作处理函数，则优先使用用户的函数处理操作。
3. 如果用户没有提供操作处理函数，或者用户的函数没有处理特定操作，则使用默认的操作处理逻辑。

### 事件捕获与转发

系统会捕获表格的各种事件，如单元格点击、值变化、列宽调整等，并将其转化为标准的操作类型，然后交由操作处理函数处理。这种方式使得用户可以在一个统一的地方处理所有表格相关的事件和操作。

## 参数说明

### OperationHandler 函数

```typescript
type OperationHandler = (operationType: OperationType, value: OperationValue) => void
```

- **operationType**: 操作类型，为 OperationType 枚举中的一个值。
- **value**: 操作值，包含与操作相关的参数和数据。

### useOperationHandler Hook

```typescript
const useOperationHandler = (onOperation?: OperationHandler, tableInstance?: ListTable | null) => OperationHandler
```

- **onOperation**: 可选参数，用户提供的操作处理函数。
- **tableInstance**: 可选参数，表格实例，用于执行默认操作逻辑。
- **返回值**: 一个统一的操作处理函数，用于处理所有表格操作。

### VisTable 组件的 onOperation 参数

```typescript
interface VisTableProps {
  sheetId: number
  onOperation?: OperationHandler
}
```

- **sheetId**: 表格ID，用于标识表格。
- **onOperation**: 可选参数，用户提供的操作处理函数。

## 返回值说明

操作处理函数本身不返回任何值，但在默认实现中，某些操作（如获取单元格值）会返回相应的结果。用户自定义的操作处理函数可以根据需要进行结果处理和返回。

## 使用示例

### 基本用法

```tsx
import { VisTable, OperationType } from '@/components/VisTable'

const App = () => {
  const handleOperation = (operationType, value) => {
    console.log(`操作类型: ${operationType}`, value)

    switch (operationType) {
      case OperationType.CELL_CLICK:
        console.log('单元格点击:', value.col, value.row)
        break
      case OperationType.CELL_CHANGE:
        console.log('单元格值变化:', value.oldValue, ' -> ', value.newValue)
        break
    }
  }

  return <VisTable sheetId="sheet1" onOperation={handleOperation} />
}
```

### 数据处理示例

```tsx
import { VisTable, OperationType } from '@/components/VisTable'
import { message } from 'antd'

const DataTableComponent = () => {
  const handleOperation = (operationType, value) => {
    // 处理数据相关操作
    if (operationType === OperationType.SET_RECORDS) {
      console.log('设置表格数据:', value.records)
      // 可以在这里进行数据校验、转换等操作

      // 操作成功后显示提示
      message.success('数据加载成功！')
    } else if (operationType === OperationType.ADD_RECORD) {
      console.log('添加数据记录:', value.record)
      // 可以在这里进行数据提交、同步等操作

      // 操作成功后显示提示
      message.success('数据添加成功！')
    }
  }

  return <VisTable sheetId="dataTable" onOperation={handleOperation} />
}
```
