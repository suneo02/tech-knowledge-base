# MultiTable 组件设计文档

## 概述

MultiTable 是一个基于 VTable 的高性能表格组件，支持虚拟滚动和复杂的表格操作。该组件提供了一套完整的表格上下文管理系统，包括表格引用管理、操作记录、AI任务处理等功能，使得表格可以在复杂的应用场景中灵活使用。

## 详细功能说明

MultiTable 组件的核心功能包括：

1. **表格引用管理**：通过 `MultiTableRefProvider` 和 `useMultiTableRef` 提供对表格实例的统一访问
2. **表格操作记录**：使用 `TableOperationProvider` 记录和管理表格的所有操作
3. **AI任务处理**：通过 `TableAITaskProvider` 支持AI辅助的表格操作
4. **表格操作封装**：提供 `useMultiTableOperations` hook，封装了常用的表格操作方法
5. **事件处理**：支持表格的各种事件监听和处理

整个组件采用 Context API 构建，各个功能模块之间松耦合，可以根据需要组合使用。

### 核心结构

```
MultiTable/
├── components/      # 子组件
├── context/         # 上下文管理
│   ├── MultiTableRefContext.tsx  # 表格引用上下文
│   ├── TableOperationContext.tsx # 表格操作上下文
│   └── TableAITaskContext.tsx    # AI任务上下文
├── hooks/           # 自定义hooks
│   ├── useMultiTableOperations.ts # 表格操作方法
│   └── ...
├── types/           # 类型定义
├── utils/           # 工具函数
└── index.tsx        # 主组件
```

## 参数说明

### MultiTable 组件参数

| 参数名                | 类型                                       | 描述               |
| --------------------- | ------------------------------------------ | ------------------ |
| id                    | string                                     | 表格唯一标识符     |
| style                 | CSSProperties                              | 表格样式           |
| children              | ReactNode                                  | 子元素             |
| handleRecordOperation | (operation: TableOperation) => void        | 操作记录处理函数   |
| onCellClickBySource   | (value?: onCellClickBySourceProps) => void | 单元格点击事件处理 |

### useMultiTableRef 返回值

| 属性名                | 类型                                  | 描述               |
| --------------------- | ------------------------------------- | ------------------ |
| multiTableRef         | React.RefObject<ListTable>            | 表格实例引用       |
| setMultiTableInstance | (instance: ListTable \| null) => void | 设置表格实例的方法 |

### useMultiTableOperations 返回值

| 方法名              | 参数                                                | 返回值                      | 描述                       |
| ------------------- | --------------------------------------------------- | --------------------------- | -------------------------- |
| getColumns          | -                                                   | ColumnDefine[] \| undefined | 获取表格列定义             |
| getAllColumnHeaders | -                                                   | ColumnHeader[] \| []        | 获取表格所有列头单元格     |
| getSelectedCells    | -                                                   | CellInfo[] \| []            | 获取当前选中的单元格信息   |
| setCellValue        | (col: number, row: number, value: string \| number) | boolean                     | 修改单元格的值             |
| getVisibleRect      | -                                                   | Rect \| undefined           | 获取表格可见区域的矩形区域 |
| refresh             | -                                                   | boolean                     | 刷新表格                   |
| getTableDomElement  | -                                                   | HTMLElement \| null         | 获取表格DOM元素            |
| getTableInstance    | -                                                   | ListTable \| null           | 获取原始表格实例           |

## 使用示例

```tsx
import MultiTable, { useMultiTableRef, useMultiTableOperations } from '@/components/MultiTable'

const MyComponent = () => {
  // 处理表格操作
  const handleOperation = (operation) => {
    console.log('表格操作:', operation)
  }

  // 处理单元格点击
  const handleCellClick = (cellInfo) => {
    if (cellInfo) {
      console.log('单元格点击:', cellInfo)
    }
  }

  return (
    <MultiTable
      id="my-table"
      style={{ height: 600, width: '100%' }}
      handleRecordOperation={handleOperation}
      onCellClickBySource={handleCellClick}
    />
  )
}

// 在表格Context内部使用hooks获取表格实例和操作方法
const TableOperations = () => {
  const { multiTableRef } = useMultiTableRef()
  const tableOperations = useMultiTableOperations()

  const handleClick = () => {
    // 获取表格所有列
    const columns = tableOperations.getColumns()
    console.log('表格列:', columns)

    // 刷新表格
    tableOperations.refresh()
  }

  return <button onClick={handleClick}>获取表格信息</button>
}
```
