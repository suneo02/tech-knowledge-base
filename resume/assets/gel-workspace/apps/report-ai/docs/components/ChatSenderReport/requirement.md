# ChatSenderReport 需求规格

## 用户故事

### 主要功能需求

#### US001 - 文本输入交互

**作为**报告AI用户，**我希望**能输入多行文本消息描述写作思路，**以便**AI理解需求并生成相应报告。

#### US002 - '@'快速引用

**作为**报告AI用户，**我希望**使用'@'符号快速引用已上传文件，**以便**明确指定AI需要关注的内容。输入@时弹出引用文件窗口，显示所有已上传的文件供选择。

#### US003 - 文件上传集成

**作为**报告AI用户，**我希望**在聊天发送器中便捷上传文件，**以便**为'@'引用功能提供文件来源。支持最多同时上传4份文件，超过限制时显示提示。更详细的文件上传需求请参考[文件上传功能需求](../../shared/FileUpload/requirements.md)。

#### US004 - 消息发送处理

**作为**报告AI用户，**我希望**发送包含文件的消息给AI，**以便**开始报告生成流程。

## 功能流程

```mermaid
graph TD
    A[用户访问界面] --> B[输入文本/上传文件]
    B --> C{检测@符号?}
    C -->|是| D[显示文件选择菜单]
    C -->|否| E[继续输入]
    D --> F[选择文件引用]
    F --> G[插入引用标记]
    G --> E
    E --> H[点击发送]
    H --> I[处理文件分类]
    I --> J[调用AI接口]
    J --> K[显示响应结果]
```

## 验收标准

| 功能项         | 验收标准                                                                                       | 优先级 |
| -------------- | ---------------------------------------------------------------------------------------------- | ------ |
| 文本输入       | 支持多行输入，自动调整高度，实时验证                                                           | P0     |
| '@'引用        | 输入@时弹出引用文件窗口，显示所有已上传文件，支持键盘导航选择                                  | P0     |
| 引用标记       | 文件引用以`@[fileName]`格式显示                                                                | P0     |
| 数据分离       | 区分上传文件(files)和引用文件(refFiles)                                                        | P0     |
| 文件上传限制   | 最多同时上传4份文件，超过时显示toast提示"最多可上传四份文件"                                   | P0     |
| 文件上传进度   | 显示上传进度，不同文件类型使用不同样式，参考UI切图                                             | P0     |
| 文件上传状态   | 上传成功后在输入框中展示，支持删除操作，失败时显示重新上传选项                                 | P0     |
| 占位符动态更新 | 上传文件后更新占位符为"告诉我您的写作思路，根据文件内容为您生成报告"                           | P0     |
| 文件上传集成   | 集成通用文件上传功能，详见[文件上传验收标准](../../shared/FileUpload/requirements.md#验收标准) | P0     |
| 状态管理       | 清晰的加载、成功、错误状态提示                                                                 | P1     |
| 响应式布局     | 移动端和桌面端良好适配                                                                         | P2     |

## 异常场景处理

| 场景             | 处理方式                                                                     |
| ---------------- | ---------------------------------------------------------------------------- |
| 无内容发送       | 发送按钮禁用状态                                                             |
| '@'无可引用文件  | 显示"暂无可引用文件"提示                                                     |
| 引用文件被删除   | 标记显示为无效状态，保留引用文本                                             |
| 文件数量超限     | 显示toast提示"最多可上传四份文件"，阻止继续上传                              |
| 文件上传失败     | 显示失败状态，提供"重新上传"按钮                                             |
| 网络异常         | 显示重试选项，保持用户输入                                                   |
| 文件上传相关异常 | 参考[文件上传异常处理](../../shared/FileUpload/requirements.md#异常场景处理) |

## 技术约束

### 性能要求

- 响应时间：文本输入 < 100ms，'@'引用菜单 < 200ms
- 文件上传相关性能要求：参考[文件上传技术约束](../../shared/FileUpload/requirements.md#技术约束)

### 兼容性要求

- 支持主流浏览器（Chrome、Firefox、Safari、Edge）
- 移动端H5支持
- 键盘无障碍访问
