# Spec 文档编写规范

## 快速准则

- 面向任务全景，比 Issue 文档更详尽：同一任务允许多份 Spec，但须在一份索引中串联。
- 先记录背景与需求，再逐步扩展设计、拆解与实现；保证每次提交的内容可独立评审。
- 所有结论引用来源：需求文档、设计稿、Issue、代码 `@see 路径:行号`。
- 仅描述功能范围、交互、数据、依赖与实施计划，性能/监控/运维等非功能内容移至附录或外链。
- 结构优先于叙述，表格/流程图/Mermaid 图代替长段文字，保持 ≤ 2 页。
- 单份文档建议控制在约 100 行，常规场景不应超过 150 行；若确因复杂模块需要超出，需在更新记录注明原因。
- 目录/文件命名可复用后续任务：支持复制、拆分与归档。

## 目录约定

- 每个任务一个目录：`docs/specs/<task-slug>/`（或同层 `apps/<app>/docs/specs/<task-slug>/`）。
- 目录内仅保留 Markdown 文件：必含 `README.md` 作为总览，其余子主题按需创建 `spec-[子主题]-v[迭代序号].md`。
- `README.md` 维护目录结构、版本状态与关键链接；每份子 Spec 顶部需回链 `README.md` 并标注所属阶段。
- 同一任务关联的需求、设计、Issue 等文档可位于其他目录，但必须在 `README.md` 中列出并使用相对路径互相引用，并在子 Spec 中回链相关 Issue / PR。

## 推荐结构

1. **任务概览**（`README.md`）：表格列出任务来源、负责人、目标上线时间、当前版本、关联文档。
2. **背景与上下文**（`spec-require-v*.md` 或并入 `spec-core-v*.md`）：总结业务目标、已有能力、遗留问题；必要时嵌入时间线或上下游示意。
3. **需求提炼**（`spec-require-v*.md`）：按用户场景列出必须满足的能力与约束，引用需求文档或问题单。
4. **方案设计**（`spec-design-v*.md` 或 `spec-core-v*.md`）：模块拆分、状态流转、接口契约、关键算法/Hook；用 Mermaid 或表格描述流程与依赖。
5. **实施拆解**（`spec-implementation-plan-v*.md`）：将方案拆成 ≤7 个可交付子任务，标注负责人、关联代码目录、预计交付时间。
6. **验收记录**（`spec-verification-v*.md` 或归并至实施文档）：列出功能验收用例与结果；若存在非功能风险，单行备注或外链。
7. **实现说明**（`spec-release-note-v*.md` 或 `spec-implementation-note-v*.md`）：上线后补充最终实现差异、主要 PR 与验收结果，必要时附执行截图或日志。
8. **更新记录**（所有文档均需保留章节）：日期 + 修改人 + 更新内容摘要；重要决策用要点记录取舍理由。

## 长度控制与拆分策略

- 若单份 Spec 预计超过 150 行，应评估是否拆分为更细的子主题（例如将设计、拆解分离），或将部分内容沉淀到专门的需求/设计文档。
- 若单份 Spec 少于 50 行且结构不完整，需考虑与相邻子主题合并，或补充背景、方案、验收等必要信息后再提交。
- 每次拆分/合并需同步更新 `README.md` 的文档索引，确保索引中能清晰定位到拆分后的子文档。

## 写作流程

- **起草**：创建目录结构与任务概览，`README.md` 先搭建章节并标记空段落为 `TODO`，列出待补充信息来源。
- **逐步完善**：每次迭代至少更新“方案设计”或“实施拆解”中的一块内容，并在更新记录登记。
- **评审同步**：在评审会议前导出最新版本，确保链接可访问，必要时附 PR 草稿。
- **交付归档**：上线后一周内完成“实现说明”填写，并在 `README.md` 更新状态为 ✅。

## 检查清单

- [ ] 任务目录存在并包含 `README.md` 与至少一份 `spec-*.md` 文档。
- [ ] 背景、需求、设计、拆解、实现说明均已覆盖且引用来源完整。
- [ ] 子任务拆解与实现说明互相对应，时间与负责人明确。
- [ ] 验收用例覆盖核心功能路径；监控或其他非功能信息仅在必要时以附录/链接补充。
- [ ] 更新记录最新，链接均为相对路径，且 PR / Issue 已互相引用。

## 相关

- [文档规范](./documentation-rule.md)
- [需求规范](./require-doc.md)
- [设计规范](./design-doc.md)
- [Issue 规范](./issue-doc-rule.md)
- [前端开发通用基线](./frontend-baseline.md)
