<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>åµŒå…¥å¼èŠå¤©ç»„ä»¶æ¼”ç¤º</title>
    <style>
      body {
        font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f5f5f5;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 20px;
      }

      h1 {
        color: #333;
        font-size: 24px;
        margin-bottom: 20px;
      }

      .demo-section {
        margin-bottom: 30px;
      }

      .demo-section h2 {
        font-size: 18px;
        color: #444;
        margin-bottom: 15px;
      }

      .demo-section p {
        color: #666;
        margin-bottom: 10px;
        line-height: 1.5;
      }

      .iframe-container {
        border: 1px solid #ddd;
        border-radius: 6px;
        overflow: hidden;
        margin-top: 15px;
      }

      .controls {
        margin: 15px 0;
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
      }

      .controls input {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        min-width: 100px;
      }

      .controls button {
        padding: 8px 16px;
        background-color: #1890ff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      .controls button:hover {
        background-color: #40a9ff;
      }

      .code-block {
        background-color: #f8f8f8;
        border-radius: 4px;
        padding: 15px;
        font-family: monospace;
        white-space: pre-wrap;
        margin: 10px 0;
        border-left: 3px solid #1890ff;
      }

      .status-indicator {
        display: flex;
        align-items: center;
        margin-top: 10px;
        font-size: 14px;
      }

      .status-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
      }

      .status-active {
        background-color: #52c41a;
      }

      .status-inactive {
        background-color: #d9d9d9;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1>åµŒå…¥å¼èŠå¤©ç»„ä»¶æ¼”ç¤º</h1>

      <div class="demo-section">
        <h2>åŸºæœ¬ç¤ºä¾‹</h2>
        <p>è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„åµŒå…¥å¼èŠå¤©ç»„ä»¶ï¼Œæ²¡æœ‰ä»»ä½•å‚æ•°ï¼š</p>
        <div class="iframe-container">
          <iframe id="basic-iframe" src="" width="100%" height="500px" frameborder="0"></iframe>
        </div>
        <div class="status-indicator">
          <span class="status-dot status-inactive" id="basic-status-dot"></span>
          <span id="basic-status-text">AIæœªå“åº”</span>
        </div>
        <div class="code-block" id="basic-code">
          &lt;iframe src="" width="100%" height="500px" frameborder="0" &gt;&lt;/iframe&gt;
        </div>
      </div>

      <div class="demo-section">
        <h2>å¸¦åˆå§‹é—®é¢˜çš„ç¤ºä¾‹</h2>
        <p>é€šè¿‡URLå‚æ•°ä¼ é€’åˆå§‹é—®é¢˜ï¼š</p>
        <div class="controls">
          <input type="text" id="question-input" placeholder="è¾“å…¥åˆå§‹é—®é¢˜" value="è¯·ç®€å•ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±" />
          <button id="update-question-btn">æ›´æ–°</button>
        </div>
        <div class="iframe-container">
          <iframe id="question-iframe" src="" width="100%" height="500px" frameborder="0"></iframe>
        </div>
        <div class="status-indicator">
          <span class="status-dot status-inactive" id="question-status-dot"></span>
          <span id="question-status-text">AIæœªå“åº”</span>
        </div>
        <div class="code-block" id="question-code">
          &lt;iframe src="" width="100%" height="500px" frameborder="0" &gt;&lt;/iframe&gt;
        </div>
      </div>

      <div class="demo-section">
        <h2>å¸¦æ·±åº¦æ€è€ƒçš„ç¤ºä¾‹</h2>
        <p>å¼€å¯æ·±åº¦æ€è€ƒæ¨¡å¼ï¼š</p>
        <div class="controls">
          <input type="text" id="deepthink-input" placeholder="è¾“å…¥å¤æ‚é—®é¢˜" value="åˆ†æä¸€ä¸‹äººå·¥æ™ºèƒ½çš„æœªæ¥å‘å±•è¶‹åŠ¿" />
          <button id="update-deepthink-btn">æ›´æ–°</button>
        </div>
        <div class="iframe-container">
          <iframe id="deepthink-iframe" src="" width="100%" height="500px" frameborder="0"></iframe>
        </div>
        <div class="status-indicator">
          <span class="status-dot status-inactive" id="deepthink-status-dot"></span>
          <span id="deepthink-status-text">AIæœªå“åº”</span>
        </div>
        <div class="code-block" id="deepthink-code">
          &lt;iframe src="" width="100%" height="500px" frameborder="0" &gt;&lt;/iframe&gt;
        </div>
      </div>

      <div class="demo-section">
        <h2>å¸¦å®ä½“ç±»å‹å’Œåç§°çš„ç¤ºä¾‹</h2>
        <p>ä¼ é€’å®ä½“ç±»å‹å’Œåç§°ï¼š</p>
        <div class="controls">
          <input type="text" id="entity-question-input" placeholder="è¾“å…¥åˆå§‹é—®é¢˜" value="åˆ†æä¸€ä¸‹è¿™ä¸ªå…¬å¸çš„ç«äº‰ä¼˜åŠ¿" />
          <input type="text" id="entity-type-input" placeholder="å®ä½“ç±»å‹" value="company" />
          <input type="text" id="entity-name-input" placeholder="å®ä½“åç§°" value="é˜¿é‡Œå·´å·´" />
          <button id="update-entity-btn">æ›´æ–°</button>
        </div>
        <div class="iframe-container">
          <iframe id="entity-iframe" src="" width="100%" height="500px" frameborder="0"></iframe>
        </div>
        <div class="status-indicator">
          <span class="status-dot status-inactive" id="entity-status-dot"></span>
          <span id="entity-status-text">AIæœªå“åº”</span>
        </div>
        <div class="code-block" id="entity-code">
          &lt;iframe src="" width="100%" height="500px" frameborder="0" &gt;&lt;/iframe&gt;
        </div>
      </div>
    </div>

    <script>
      const IP = 'http://10.100.244.68:3080/#'

      // è®¾ç½®åŸºæœ¬iframeçš„src
      const basicSrc = `${IP}/embed-chat`
      document.getElementById('basic-iframe').src = basicSrc
      document.getElementById('basic-code').textContent = `<iframe 
  src="${basicSrc}" 
  width="100%" 
  height="500px" 
  frameborder="0"
></iframe>`

      // ç›‘å¬æ‰€æœ‰iframeå‘é€çš„æ¶ˆæ¯
      window.addEventListener('message', function (event) {
        // å¿½ç•¥æ¥è‡ªReactå¼€å‘è€…å·¥å…·çš„æ¶ˆæ¯
        if (event.data && event.data.source === 'react-devtools-content-script') {
          return
        }

        console.log('ğŸš€ ~ event:', event)
        // æ£€æŸ¥æ¶ˆæ¯ç±»å‹
        if (event.data && event.data.type === 'CHAT_STATUS_CHANGE') {
          const isChating = event.data.payload.isChating
          // æ ¹æ®iframeçš„æºç¡®å®šè¦æ›´æ–°å“ªä¸ªçŠ¶æ€æŒ‡ç¤ºå™¨
          const sourceWindow = event.source

          // æ›´æ–°å¯¹åº”çš„çŠ¶æ€æŒ‡ç¤ºå™¨
          if (sourceWindow === document.getElementById('basic-iframe').contentWindow) {
            updateStatusIndicator('basic', isChating)
          } else if (sourceWindow === document.getElementById('question-iframe').contentWindow) {
            updateStatusIndicator('question', isChating)
          } else if (sourceWindow === document.getElementById('deepthink-iframe').contentWindow) {
            updateStatusIndicator('deepthink', isChating)
          } else if (sourceWindow === document.getElementById('entity-iframe').contentWindow) {
            updateStatusIndicator('entity', isChating)
          }
        }
      })

      // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
      function updateStatusIndicator(prefix, isChating) {
        const dot = document.getElementById(`${prefix}-status-dot`)
        const text = document.getElementById(`${prefix}-status-text`)

        if (isChating) {
          dot.className = 'status-dot status-active'
          text.textContent = 'AIæ­£åœ¨å›ç­”...'
        } else {
          dot.className = 'status-dot status-inactive'
          text.textContent = 'AIæœªå“åº”'
        }
      }

      // æ›´æ–°å¸¦åˆå§‹é—®é¢˜çš„iframe
      document.getElementById('update-question-btn').addEventListener('click', function () {
        const question = document.getElementById('question-input').value
        const encodedQuestion = encodeURIComponent(question)
        const newSrc = `${IP}/embed-chat?initialMsg=${encodedQuestion}`

        // å¼ºåˆ¶iframeé‡æ–°åŠ è½½
        const iframe = document.getElementById('question-iframe')
        iframe.src = 'about:blank'
        setTimeout(() => {
          iframe.src = newSrc
        }, 50)

        document.getElementById('question-code').textContent = `<iframe 
  src="${newSrc}" 
  width="100%" 
  height="500px" 
  frameborder="0"
></iframe>`
      })

      // æ›´æ–°å¸¦æ·±åº¦æ€è€ƒçš„iframe
      document.getElementById('update-deepthink-btn').addEventListener('click', function () {
        const question = document.getElementById('deepthink-input').value
        const encodedQuestion = encodeURIComponent(question)
        const newSrc = `${IP}/embed-chat?initialMsg=${encodedQuestion}&initialDeepthink=1`

        // å¼ºåˆ¶iframeé‡æ–°åŠ è½½
        const iframe = document.getElementById('deepthink-iframe')
        iframe.src = 'about:blank'
        setTimeout(() => {
          iframe.src = newSrc
        }, 50)

        document.getElementById('deepthink-code').textContent = `<iframe 
  src="${newSrc}" 
  width="100%" 
  height="500px" 
  frameborder="0"
></iframe>`
      })

      // æ›´æ–°å¸¦å®ä½“ç±»å‹å’Œåç§°çš„iframe
      document.getElementById('update-entity-btn').addEventListener('click', function () {
        const question = document.getElementById('entity-question-input').value
        const entityType = document.getElementById('entity-type-input').value
        const entityName = document.getElementById('entity-name-input').value

        const encodedQuestion = encodeURIComponent(question)
        const encodedEntityType = encodeURIComponent(entityType)
        const encodedEntityName = encodeURIComponent(entityName)

        const newSrc = `${IP}/embed-chat?initialMsg=${encodedQuestion}&entityType=${encodedEntityType}&entityName=${encodedEntityName}`

        // å¼ºåˆ¶iframeé‡æ–°åŠ è½½
        const iframe = document.getElementById('entity-iframe')
        iframe.src = 'about:blank'
        setTimeout(() => {
          iframe.src = newSrc
        }, 50)

        document.getElementById('entity-code').textContent = `<iframe 
  src="${newSrc}" 
  width="100%" 
  height="500px" 
  frameborder="0"
></iframe>`
      })

      // åˆå§‹åŒ–è§¦å‘ä¸€æ¬¡æ›´æ–°
      // document.getElementById('update-question-btn').click()
      // document.getElementById('update-deepthink-btn').click()
      // document.getElementById('update-entity-btn').click()
    </script>
  </body>
</html>
