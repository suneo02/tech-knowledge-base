# 验证计划 - 标题嵌套假设问题

> 📖 [返回问题概览](./README.md) | 遵循 [Issue 文档编写规范](../../../../../docs/rule/issue-doc-rule.md)

## 验证步骤

### 1. AI 生成内容验证

**目标**：确认 AI 生成的 HTML 结构特征

**步骤**：

1. 触发 AI 生成多个章节（至少 10 次）
2. 检查生成的 HTML 结构
3. 记录是否存在嵌套标题

**预期结果**：AI 生成的 HTML 标题始终在最外层

**状态**：⏸️ 待执行

### 2. 粘贴内容验证

**目标**：验证 TinyMCE 粘贴行为

**步骤**：

1. 从 Word 文档粘贴复杂 HTML
2. 从网页粘贴复杂 HTML
3. 观察 TinyMCE 如何处理嵌套结构

**预期结果**：了解 TinyMCE 是否会保持或规范化嵌套结构

**状态**：⏸️ 待执行

### 3. 历史数据验证

**目标**：检查现有报告数据是否存在嵌套标题

**步骤**：

1. 随机抽查 20+ 个历史报告
2. 检查 HTML 结构
3. 统计嵌套标题的出现频率

**预期结果**：了解问题的实际影响范围

**状态**：⏸️ 待执行

### 4. 边界测试

**目标**：验证解析行为

**步骤**：

1. 手动构造嵌套场景（参考问题分析中的示例）
2. 执行解析流程
3. 检查内容收集是否完整

**预期结果**：确认嵌套场景下的解析问题

**状态**：⏸️ 待执行

### 5. 回归测试

**目标**：确保修改不影响现有功能

**步骤**：

1. 执行完整测试套件
2. 测试标准场景（平级结构）
3. 测试边缘场景（嵌套结构）

**预期结果**：所有测试通过

**状态**：⏸️ 待执行

## 测试用例

| 用例编号 | 测试场景             | 预期结果         | 状态 |
| -------- | -------------------- | ---------------- | ---- |
| TC-01    | 标准平级结构         | 正确解析所有章节 | ⏸️   |
| TC-02    | 标题嵌套在 div 中    | 正确解析所有章节 | ⏸️   |
| TC-03    | 标题与内容在不同容器 | 正确解析所有章节 | ⏸️   |
| TC-04    | 复杂嵌套结构         | 正确解析所有章节 | ⏸️   |
| TC-05    | 空标题               | 正确处理边界情况 | ⏸️   |
| TC-06    | 标题后无内容         | 正确处理边界情况 | ⏸️   |
| TC-07    | 多层嵌套标题         | 正确提升所有标题 | ⏸️   |

## 剩余风险

| 风险                            | 影响 | 概率 | 应对方案                      |
| ------------------------------- | ---- | ---- | ----------------------------- |
| AI 生成逻辑变更引入新的结构问题 | 高   | 低   | 添加结构校验监控              |
| TinyMCE 版本升级改变粘贴行为    | 中   | 低   | 锁定 TinyMCE 版本，升级前测试 |
| 结构规范化影响特殊 HTML 格式    | 中   | 中   | 添加白名单，保护特殊结构      |
| 未预见的嵌套场景                | 中   | 中   | 持续监控解析错误日志          |

## 监控建议

### 运行时监控

1. **解析错误监控**：记录结构异常的 HTML 样本
2. **结构校验日志**：在解析流程中添加结构校验日志
3. **定期审查**：定期审查解析错误日志，发现新的边界场景

### 监控指标

| 指标           | 监控方式 | 告警阈值 |
| -------------- | -------- | -------- |
| 解析失败率     | 错误日志 | > 1%     |
| 结构规范化次数 | 信息日志 | > 10%    |
| 内容丢失率     | 数据校验 | > 0.1%   |

## 更新记录

| 日期       | 修改人 | 更新内容             |
| ---------- | ------ | -------------------- |
| 2025-10-29 | Kiro   | 从主文档拆分验证计划 |
