# 实施计划：统一配置源重构

> 所属任务：[企业详情页配置重复维护问题](./README.md)  
> 文档版本：v1  
> 创建日期：2024-11-07

## 任务拆解

### 阶段一：基础设施搭建

#### 任务 1.1：定义统一配置数据结构

**负责人**：待分配  
**预计工期**：1 天  
**交付物**：

- `src/types/module-config.ts` - TypeScript 接口定义
- 配置示例文档

**验收标准**：

- [ ] 接口定义完整，包含所有必要字段
- [ ] 支持菜单配置、内容配置、可见性控制
- [ ] 通过 TypeScript 类型检查

**关联代码**：

- @see [方案设计](./spec-design-v1.md#统一配置数据结构)

---

#### 任务 1.2：创建配置转换工具

**负责人**：待分配  
**预计工期**：2 天  
**交付物**：

- `src/utils/module-config-converter.ts` - 配置转换函数
- `src/utils/module-visibility-filter.ts` - 可见性过滤器
- 单元测试

**验收标准**：

- [ ] 实现菜单配置转换函数
- [ ] 实现内容配置转换函数
- [ ] 实现可见性过滤逻辑
- [ ] 单元测试覆盖率 ≥ 80%

**关联代码**：

- @see [方案设计](./spec-design-v1.md#配置转换工具)

---

### 阶段二：配置迁移

#### 任务 2.1：创建统一配置文件

**负责人**：待分配  
**预计工期**：3 天  
**交付物**：

- `src/config/unified-module-config.ts` - 统一配置源
- 配置迁移对照表

**验收标准**：

- [ ] 迁移所有现有模块配置
- [ ] 统计字段映射完整
- [ ] 可见性规则覆盖所有企业类型
- [ ] 配置顺序与现有保持一致

**依赖**：任务 1.1、任务 1.3

**关联代码**：

- @see `src/views/Company/menu/useCorpMenuByType.ts`
- @see `src/components/company/listRowConfig.tsx`

---

### 阶段三：业务逻辑重构

#### 任务 3.1：重构菜单配置生成逻辑

**负责人**：待分配  
**预计工期**：2 天  
**交付物**：

- 重构后的 `useCorpMenuByType.ts`
- 集成测试

**验收标准**：

- [ ] 使用统一配置源生成菜单
- [ ] 移除重复的统计字段映射
- [ ] 移除重复的过滤逻辑
- [ ] 功能与重构前保持一致

**依赖**：任务 1.2、任务 2.1

**关联代码**：

- @see `src/views/Company/menu/useCorpMenuByType.ts`
- @see `src/views/Company/menu/getMenuByCorpType.ts`

---

#### 任务 3.2：重构内容配置生成逻辑

**负责人**：待分配  
**预计工期**：2 天  
**交付物**：

- 重构后的 `listRowConfig.tsx`
- 集成测试

**验收标准**：

- [ ] 使用统一配置源生成内容
- [ ] 移除重复的统计字段映射
- [ ] 移除重复的过滤逻辑
- [ ] 功能与重构前保持一致

**依赖**：任务 1.2、任务 2.1

**关联代码**：

- @see `src/components/company/listRowConfig.tsx`
- @see `src/components/company/handle/index.ts`

---

#### 任务 3.3：更新特殊企业过滤逻辑

**负责人**：待分配  
**预计工期**：1 天  
**交付物**：

- 重构后的 `CompanyBase.tsx`
- 集成测试

**验收标准**：

- [ ] 移除对菜单配置的依赖
- [ ] 使用统一的可见性规则
- [ ] 特殊企业过滤功能正常

**依赖**：任务 3.1、任务 3.2

**关联代码**：

- @see `src/components/company/CompanyBase.tsx:1046-1050`

---

### 阶段四：测试与上线

#### 任务 4.1：完整回归测试

**负责人**：待分配  
**预计工期**：2 天  
**交付物**：

- 测试用例清单
- 测试报告

**验收标准**：

- [ ] 各企业类型菜单显示正确
- [ ] 海外企业过滤功能正常
- [ ] 个体工商户过滤功能正常
- [ ] 特殊企业过滤功能正常
- [ ] 统计数字显示正确
- [ ] 无回归问题

**依赖**：任务 3.3

---

## 时间规划

| 阶段     | 任务数 | 预计工期  | 依赖关系 |
| -------- | ------ | --------- | -------- |
| 基础设施 | 2      | 3 天      | 无       |
| 配置迁移 | 1      | 3 天      | 阶段一   |
| 业务重构 | 3      | 5 天      | 阶段二   |
| 测试上线 | 1      | 2 天      | 阶段三   |
| **总计** | **7**  | **13 天** | -        |

## 风险控制

| 风险项         | 应对措施                       |
| -------------- | ------------------------------ |
| 配置迁移遗漏   | 制定迁移对照表，逐项核对       |
| 过滤逻辑遗漏   | 详细梳理现有逻辑，逐一验证     |
| 回归测试不充分 | 制定详细测试用例，覆盖所有场景 |
| 上线后发现问题 | 准备回滚方案，分阶段灰度上线   |

## 更新记录

| 日期       | 修改人 | 更新内容     |
| ---------- | ------ | ------------ |
| 2024-11-07 | -      | 创建实施计划 |
