# 企业详情页菜单与内容配置设计

## 概述

配置系统通过数据驱动实现左侧菜单与中间内容的动态联动。基于企业类型、统计数据和业务规则，智能构建菜单并控制模块显示。

**功能边界**：菜单配置生成、内容模块控制、企业类型适配
**关键场景**：菜单构建、模块显示控制、类型适配

## 配置体系架构

### 配置层级

| 层级         | 职责         | 来源                     | 粒度     |
| ------------ | ------------ | ------------------------ | -------- |
| **基础菜单** | 标准模块定义 | `CompanyDetailBaseMenus` | 全局     |
| **类型适配** | 企业特化     | `useCorpMenuByType`      | 企业类型 |
| **数据驱动** | 动态显示     | `basicNum` 统计          | 数据项   |
| **地区处理** | 本地化       | `corpArea` 参数          | 地区     |

### 菜单配置结构

| 字段       | 说明       | 用途         |
| ---------- | ---------- | ------------ |
| `title`    | 菜单名称   | 一级菜单标题 |
| `hide`     | 是否隐藏   | 控制可见性   |
| `showList` | 子模块标识 | 定义子模块   |
| `showName` | 子模块名称 | 显示标题     |
| `numArr`   | 统计字段   | 映射统计数据 |

### 内容配置结构

| 字段        | 说明     | 用途       |
| ----------- | -------- | ---------- |
| `moduleKey` | 模块标识 | 与菜单对应 |
| `cmd`       | API命令  | 数据接口   |
| `modelNum`  | 统计字段 | 映射统计   |
| `withTab`   | 标签页   | 启用切换   |
| `children`  | 子配置   | 标签内容   |

## 企业类型适配

### 适配策略

| 企业类型     | 菜单处理               | 内容处理                  |
| ------------ | ---------------------- | ------------------------- |
| **普通企业** | 标准菜单 + 数据驱动    | 显示所有标准模块          |
| **私募基金** | 激活 `PrivateFundData` | 显示基金专用模块          |
| **公募基金** | 激活 `PublishFundData` | 显示基金规模/旗下基金     |
| **IPO企业**  | 激活 `IpoBusinessData` | 显示产量/销量/业务量/库存 |
| **海外企业** | 名称本地化             | "工商信息" → "基本信息"   |

### 模块配置列表

| 模块              | 类型     | 默认显示 | 文件                 |
| ----------------- | -------- | -------- | -------------------- |
| `base`            | 基础信息 | 是       | `base.tsx`           |
| `IpoBusinessData` | IPO业务  | 条件     | `listRowConfig.tsx`  |
| `PublishFundData` | 公募基金 | 条件     | `listRowConfig.tsx`  |
| `PrivateFundData` | 私募基金 | 条件     | `listRowConfig.tsx`  |
| `finance`         | 财务数据 | 是       | `finance.tsx`        |
| `buss`            | 业务信息 | 是       | `buss.tsx`           |
| `qualifications`  | 资质荣誉 | 是       | `qualifications.tsx` |
| `ip`              | 知识产权 | 是       | `ip.tsx`             |
| `risk`            | 司法风险 | 是       | `risk.tsx`           |
| `bussRisk`        | 经营风险 | 是       | `bussRisk.tsx`       |
| `history`         | 历史数据 | 是       | `history.tsx`        |

## 联动机制

### 联动控制

| 企业类型     | 菜单侧              | 内容侧             | 效果     |
| ------------ | ------------------- | ------------------ | -------- |
| **普通企业** | 标准菜单 + 数据驱动 | 显示所有标准模块   | 完整展示 |
| **特殊企业** | 精简菜单            | 按 `showList` 过滤 | 精确匹配 |
| **IPO企业**  | 激活业务菜单        | 显示IPO模块        | 专用显示 |
| **基金企业** | 激活基金菜单        | 显示基金模块       | 分类展示 |

### 可见性控制

| 场景           | 菜单侧      | 内容侧       | 体验     |
| -------------- | ----------- | ------------ | -------- |
| **无数据**     | 隐藏菜单项  | 不渲染模块   | 避免空白 |
| **权限限制**   | 显示VIP提示 | 显示权限占位 | 引导升级 |
| **类型不匹配** | 过滤菜单项  | 过滤模块列表 | 精确匹配 |
| **特殊企业**   | 按配置显示  | 按菜单渲染   | 定制体验 |

### 数据同步

| 维度         | 方式           | 时机      | 保证     |
| ------------ | -------------- | --------- | -------- |
| **菜单状态** | `selectedKeys` | 点击/滚动 | 实时同步 |
| **模块数据** | 统计更新       | API响应   | 数据驱动 |
| **可见性**   | 配置变化       | 类型变更  | 配置驱动 |
| **滚动位置** | 事件监听       | 用户滚动  | 位置同步 |

## 配置使用机制

### 配置获取

通过 `useCorpMenuByType` Hook 获取菜单配置：

| 参数            | 说明         | 作用                       |
| --------------- | ------------ | -------------------------- |
| `corpBasicInfo` | 企业基本信息 | 判断企业类型               |
| `basicNum`      | 企业统计数据 | 激活专用模块、判断特殊企业 |
| `corpArea`      | 企业地区     | 地区本地化处理             |

返回：根据企业类型适配后的菜单配置对象 `allMenuDataObj`

### 模块渲染控制

#### 普通企业渲染逻辑

遍历 `listRowConfig` 配置列表，渲染所有标准模块。

#### 特殊企业渲染逻辑

**判断条件**：`basicNum.__specialcorp > 0`

**过滤规则**：

1. 遍历 `listRowConfig` 中的每个模块配置
2. 提取模块的 `moduleKey`（如 `showShareholder`、`selectList`）
3. 检查 `moduleKey` 是否存在于菜单配置 `allMenuDataObj` 中
4. 如果不存在，跳过该模块，不渲染
5. 如果存在，渲染该模块

**核心逻辑**：

- 特殊企业（社会组织、政府机构等）只渲染菜单中配置的模块
- 通过 `allMenuDataObj[theModuleKey]` 检查模块是否在菜单中
- 实现菜单与内容的精确匹配

**示例**：

- 上海工商联配置了 `showShareholder`、`selectList`、`listInformation`
- 渲染时只显示这三个模块，其他模块被过滤

### 模块显示控制流程

```
1. 获取企业数据 (basicNum, corpBasicInfo)
   ↓
2. 生成菜单配置 (useCorpMenuByType → allMenuDataObj)
   ↓
3. 判断企业类型
   ├─ 普通企业 (basicNum.__specialcorp = 0)
   │  └─ 渲染所有 listRowConfig 模块
   │
   └─ 特殊企业 (basicNum.__specialcorp > 0)
      └─ 遍历 listRowConfig
         └─ 检查 moduleKey 是否在 allMenuDataObj 中
            ├─ 存在 → 渲染模块
            └─ 不存在 → 跳过模块
```

### 关键判断点

| 判断点       | 条件                               | 结果             |
| ------------ | ---------------------------------- | ---------------- |
| **企业类型** | `basicNum.__specialcorp > 0`       | 启用特殊企业过滤 |
| **模块过滤** | `allMenuDataObj[moduleKey]` 存在   | 渲染该模块       |
| **模块过滤** | `allMenuDataObj[moduleKey]` 不存在 | 跳过该模块       |
| **菜单激活** | `hide = false`                     | 菜单项可见       |
| **数据驱动** | `basicNum[numField] > 0`           | 显示统计数字     |

## 特殊配置

### IPO业务数据

| 指标   | 子模块            | 标签页        | 图表 |
| ------ | ----------------- | ------------- | ---- |
| 产量   | `showIpoYield`    | 累计值/当期值 | 是   |
| 销量   | `showIpoSales`    | 累计值/当期值 | 是   |
| 业务量 | `showIpoBusiness` | 累计值/当期值 | 是   |
| 库存   | `showIpoStock`    | 累计值/当期值 | 是   |

### 基金数据

| 类型 | 模块              | 子模块             | 展示                     |
| ---- | ----------------- | ------------------ | ------------------------ |
| 公募 | `PublishFundData` | 基金规模、旗下基金 | 代码、名称、类型、收益率 |
| 私募 | `PrivateFundData` | 基本信息           | 基金基本信息             |

### 特殊企业配置

**上海工商联示例**：

使用精简配置 `shficRowConfig`：

- 仅配置：`showShareholder`（股东信息）、`selectList`（入选名录）、`listInformation`（上榜信息）
- 移除VIP限制：`notVipTitle: ''`
- 渲染时只显示这三个模块，其他模块被过滤

## 扩展性

### 新增企业类型

1. 定义类型标识
2. 创建专用菜单
3. 配置内容模块
4. 注册类型映射

### 新增数据模块

1. 定义模块配置
2. 添加菜单项
3. 配置统计字段
4. 更新渲染逻辑

## 相关文档

- [左侧区域设计](./layout-left.md)
- [中间区域设计](./layout-middle.md)
- [总体设计](./design.md)
- [懒加载设计](./lazyLoad.md)
