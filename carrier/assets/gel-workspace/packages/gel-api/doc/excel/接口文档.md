# Excel 接口文档

> 说明：所有接口响应均使用通用响应格式进行包装，详见[通用返回数据文档](../通用返回数据文档.md#一基础响应结构-apiresponseforsuperlist)

## 一、表格管理接口

### 1. 获取表格信息

**接口路径**：`excel/getTableInfo`

**请求参数**：

| 参数名  | 类型   | 必填 | 描述           |
| ------- | ------ | ---- | -------------- |
| tableId | string | 是   | 表格的唯一标识 |

**响应格式**：[`ApiResponseForChat<GetTableInfoResponse>`](../通用返回数据文档.md#三聊天响应结构-apiresponseforchat)

**响应参数**：

| 参数名     | 类型    | 描述           |
| ---------- | ------- | -------------- |
| sheetInfos | Sheet[] | Sheet 列表信息 |
| tableName  | string  | 表格名称       |

**响应示例**：

```json
{
  "result": {
    "sheetInfos": [
      {
        "sheetId": "sheet_001",
        "sheetName": "Sheet1",
        "sheetIndex": 0
      },
      {
        "sheetId": "sheet_002",
        "sheetName": "数据分析",
        "sheetIndex": 1
      }
    ],
    "tableName": "财务报表"
  },
  "message": "操作成功",
  "status": "success",
  "ErrorCode": 0
}
```

### 2. 更新表格名称

**接口路径**：`excel/updateTableName`

**请求参数**：

| 参数名    | 类型   | 必填 | 描述           |
| --------- | ------ | ---- | -------------- |
| tableId   | string | 是   | 表格的唯一标识 |
| tableName | string | 是   | 新的表格名称   |

**请求示例**：

```json
{
  "tableId": "table_12345678",
  "tableName": "财务报表"
}
```

**响应格式**：[`ApiResponseForChat<UpdateTableNameResponse>`](../通用返回数据文档.md#三聊天响应结构-apiresponseforchat)

**响应参数**：

| 参数名 | 类型   | 描述             |
| ------ | ------ | ---------------- |
| msg    | string | 操作结果描述信息 |

**响应示例**：

```json
{
  "result": {
    "msg": "表格名称更新成功"
  },
  "message": "操作成功",
  "status": "success",
  "ErrorCode": 0
}
```

## 二、Sheet 管理接口

### 1. 新增 Sheet

**接口路径**：`excel/addSheet`

**请求参数**：

| 参数名    | 类型   | 必填 | 描述              |
| --------- | ------ | ---- | ----------------- |
| sheetName | string | 是   | 新建 Sheet 的名称 |
| tableId   | string | 是   | 表格 Id           |

**请求示例**：

```json
{
  "sheetName": "数据分析",
  "tableId": "table_12345678"
}
```

**响应格式**：[`ApiResponseForChat<AddSheetResponse>`](../通用返回数据文档.md#三聊天响应结构-apiresponseforchat)

**响应参数**：

| 参数名 | 类型   | 描述             |
| ------ | ------ | ---------------- |
| msg    | string | 操作结果描述信息 |

**响应示例**：

```json
{
  "result": {},
  "message": "操作成功",
  "status": "success",
  "ErrorCode": 0
}
```

### 2. 删除 Sheet

**接口路径**：`excel/deleteSheet`

**请求参数**：

| 参数名  | 类型   | 必填 | 描述                      |
| ------- | ------ | ---- | ------------------------- |
| sheetId | string | 是   | 要删除的 Sheet 的唯一标识 |

**请求示例**：

```json
{
  "sheetId": "sheet_12345678"
}
```

**响应格式**：[`ApiResponseForChat<DeleteSheetResponse>`](../通用返回数据文档.md#三聊天响应结构-apiresponseforchat)

**响应参数**：

| 参数名 | 类型   | 描述             |
| ------ | ------ | ---------------- |
| msg    | string | 操作结果描述信息 |

**响应示例**：

```json
{
  "result": {},
  "message": "操作成功",
  "status": "success",
  "ErrorCode": 0
}
```

### 3. 更新 Sheet

**接口路径**：`excel/updateSheet`

**请求参数**：

| 参数名    | 类型   | 必填 | 描述                      |
| --------- | ------ | ---- | ------------------------- |
| sheetId   | string | 是   | 要更新的 Sheet 的唯一标识 |
| sheetName | string | 是   | Sheet 的新名称            |

**请求示例**：

```json
{
  "sheetId": "sheet_12345678",
  "sheetName": "更新后的数据分析"
}
```

**响应格式**：[`ApiResponseForChat<UpdateSheetResponse>`](../通用返回数据文档.md#三聊天响应结构-apiresponseforchat)

**响应参数**：

| 参数名 | 类型   | 描述             |
| ------ | ------ | ---------------- |
| msg    | string | 操作结果描述信息 |

**响应示例**：

```json
{
  "result": {},
  "message": "操作成功",
  "status": "success",
  "ErrorCode": 0
}
```

### 4. 下载 Sheet

**接口路径**：`excel/downloadSheet`

**请求参数**：

| 参数名  | 类型     | 必填 | 描述                      |
| ------- | -------- | ---- | ------------------------- |
| sheetId | string   | 是   | 要下载的 Sheet 的唯一标识 |
| filters | object[] | 否   | 筛选条件                  |
| sort    | object   | 否   | 排序条件                  |

**filters 参数说明**：

| 参数名      | 类型   | 描述     |
| ----------- | ------ | -------- |
| columnId    | string | 列 ID    |
| filterType  | number | 筛选类型 |
| filterValue | string | 筛选值   |

**sort 参数说明**：

| 参数名   | 类型   | 描述                            |
| -------- | ------ | ------------------------------- |
| columnId | string | 列 ID                           |
| sortType | string | 排序类型，'asc'升序，'desc'降序 |

**请求示例**：

```json
{
  "sheetId": "sheet_12345678",
  "filters": [
    {
      "columnId": "column_001",
      "filterType": 1,
      "filterValue": "测试"
    }
  ],
  "sort": {
    "columnId": "column_002",
    "sortType": "desc"
  }
}
```

**响应格式**：[`ApiResponseForChat<DownloadSheetResponse>`](../通用返回数据文档.md#三聊天响应结构-apiresponseforchat)

**响应参数**：

| 参数名      | 类型   | 描述     |
| ----------- | ------ | -------- |
| downloadUrl | string | 下载链接 |
| fileName    | string | 文件名称 |

**响应示例**：

```json
{
  "result": {
    "downloadUrl": "https://example.com/download/sheet_12345678.xlsx",
    "fileName": "数据分析.xlsx"
  },
  "message": "操作成功",
  "status": "success",
  "ErrorCode": 0
}
```

## 三、数据操作接口

### 1. 获取 Sheet 列信息

**接口路径**：`excel/getSheetColumns`

**请求参数**：

| 参数名  | 类型   | 必填 | 描述             |
| ------- | ------ | ---- | ---------------- |
| sheetId | string | 是   | Sheet 的唯一标识 |

**响应格式**：[`ApiResponseForChat<GetSheetColumnsResponse>`](../通用返回数据文档.md#三聊天响应结构-apiresponseforchat)

**响应参数**：

| 参数名  | 类型     | 描述       |
| ------- | -------- | ---------- |
| columns | Column[] | 列信息数组 |

**响应示例**：

```json
{
  "result": {
    "columns": [
      {
        "columnId": "column_001",
        "columnName": "公司名称",
        "columnIndex": 0,
        "dataType": 1,
        "width": 120,
        "title": "公司名称"
      },
      {
        "columnId": "column_002",
        "columnName": "行业",
        "columnIndex": 1,
        "dataType": 1,
        "width": 100,
        "title": "行业"
      }
    ]
  },
  "message": "操作成功",
  "status": "success",
  "ErrorCode": 0
}
```

### 2. 获取 Sheet 所有行 ID

**接口路径**：`excel/getSheetAllRowIds`

**请求参数**：

| 参数名  | 类型   | 必填 | 描述             |
| ------- | ------ | ---- | ---------------- |
| sheetId | string | 是   | Sheet 的唯一标识 |

**响应格式**：[`ApiResponseForChat<GetSheetAllRowIdsResponse>`](../通用返回数据文档.md#三聊天响应结构-apiresponseforchat)

**响应参数**：

| 参数名 | 类型     | 描述           |
| ------ | -------- | -------------- |
| rowIds | string[] | 所有行 ID 数组 |

**响应示例**：

```json
{
  "result": {
    "rowIds": ["row_001", "row_002", "row_003", "row_004"]
  },
  "message": "操作成功",
  "status": "success",
  "ErrorCode": 0
}
```

### 3. 获取行详情

**接口路径**：`excel/getRowsDetail`

**请求参数**：

| 参数名 | 类型     | 必填 | 描述       |
| ------ | -------- | ---- | ---------- |
| rowIds | string[] | 是   | 行 ID 数组 |

**响应格式**：[`ApiResponseForChat<GetRowsDetailResponse>`](../通用返回数据文档.md#三聊天响应结构-apiresponseforchat)

**响应参数**：

| 参数名 | 类型      | 描述       |
| ------ | --------- | ---------- |
| data   | RowData[] | 行数据数组 |

**响应示例**：

```json
{
  "result": {
    "data": [
      {
        "rowId": "row_001",
        "column_001": "阿里巴巴",
        "column_001&": {
          "processedValue": "阿里巴巴",
          "status": 3,
          "rowIndex": 0,
          "columnIndex": 0,
          "columnId": "column_001",
          "rowId": "row_001",
          "cellId": "cell_001_001",
          "sourceType": 4
        },
        "column_002": "互联网",
        "column_002&": {
          "processedValue": "互联网",
          "status": 3,
          "rowIndex": 0,
          "columnIndex": 1,
          "columnId": "column_002",
          "rowId": "row_001",
          "cellId": "cell_001_002",
          "sourceType": 4
        }
      }
    ]
  },
  "message": "操作成功",
  "status": "success",
  "ErrorCode": 0
}
```

## 四、AI 功能接口

### 1. 执行单元格任务

**接口路径**：`excel/runCell`

**请求参数**：

| 参数名   | 类型   | 必填 | 描述             |
| -------- | ------ | ---- | ---------------- |
| rowId    | string | 是   | 行 ID            |
| columnId | string | 是   | 列 ID            |
| sheetId  | string | 是   | Sheet 的唯一标识 |

**响应格式**：[`ApiResponseForChat<RunCellResponse>`](../通用返回数据文档.md#三聊天响应结构-apiresponseforchat)

**响应参数**：

| 参数名   | 类型           | 描述       |
| -------- | -------------- | ---------- |
| cellId   | string         | 单元格 ID  |
| columnId | string         | 列 ID      |
| rowId    | string         | 行 ID      |
| status   | CellStatusEnum | 单元格状态 |

**响应示例**：

```json
{
  "result": {
    "cellId": "cell_001_002",
    "columnId": "column_002",
    "rowId": "row_001",
    "status": 2
  },
  "message": "操作成功",
  "status": "success",
  "ErrorCode": 0
}
```

### 2. 执行列任务

**接口路径**：`excel/runColumn`

**请求参数**：

| 参数名   | 类型   | 必填 | 描述             |
| -------- | ------ | ---- | ---------------- |
| sheetId  | string | 是   | Sheet 的唯一标识 |
| columnId | string | 是   | 列 ID            |

**响应格式**：[`ApiResponseForChat<RunColumnResponse>`](../通用返回数据文档.md#三聊天响应结构-apiresponseforchat)

**响应参数**：

| 参数名                | 类型           | 描述                       |
| --------------------- | -------------- | -------------------------- |
| data                  | object[]       | 执行结果数据，包含如下字段 |
| data[].cellId         | string         | 单元格 ID                  |
| data[].columnId       | string         | 列 ID                      |
| data[].processedValue | string         | 处理后的值                 |
| data[].rowId          | string         | 行 ID                      |
| data[].status         | CellStatusEnum | 单元格状态                 |

**响应示例**：

```json
{
  "result": {
    "data": [
      {
        "cellId": "cell_001_002",
        "columnId": "column_002",
        "processedValue": "互联网",
        "rowId": "row_001",
        "status": 3
      },
      {
        "cellId": "cell_002_002",
        "columnId": "column_002",
        "processedValue": "金融",
        "rowId": "row_002",
        "status": 3
      }
    ]
  },
  "message": "操作成功",
  "status": "success",
  "ErrorCode": 0
}
```

### 3. AI 生成列

**接口路径**：`excel/aiInsertColumn`

**请求参数**：

| 参数名           | 类型        | 必填 | 描述             |
| ---------------- | ----------- | ---- | ---------------- |
| columnId         | string      | 是   | 列 ID            |
| columnIndex      | number      | 否   | 列索引           |
| sheetId          | string      | 是   | Sheet 的唯一标识 |
| prompt           | string      | 是   | 提示词           |
| aiModel          | AiModelEnum | 是   | AI 模型          |
| tool             | object      | 是   | 工具配置         |
| promptPattern    | string      | 是   | 提示词模式       |
| enableAutoUpdate | boolean     | 是   | 是否启用自动更新 |

**响应格式**：[`ApiResponseForChat<AiInsertColumnResponse>`](../通用返回数据文档.md#三聊天响应结构-apiresponseforchat)

**响应参数**：

| 参数名 | 类型     | 描述                                 |
| ------ | -------- | ------------------------------------ |
| data   | object[] | 生成结果数据，格式同执行列任务的响应 |

**响应示例**：

```json
{
  "result": {
    "data": [
      {
        "cellId": "cell_001_003",
        "columnId": "column_003",
        "processedValue": "电子商务",
        "rowId": "row_001",
        "status": 3
      },
      {
        "cellId": "cell_002_003",
        "columnId": "column_003",
        "processedValue": "银行业务",
        "rowId": "row_002",
        "status": 3
      }
    ]
  },
  "message": "操作成功",
  "status": "success",
  "ErrorCode": 0
}
```

### 4. 生成列名

**接口路径**：`intelligentFill/generateColumnName`

**请求参数**：

| 参数名     | 类型   | 必填 | 描述             |
| ---------- | ------ | ---- | ---------------- |
| promptText | string | 是   | 提示文本         |
| sheetId    | string | 是   | Sheet 的唯一标识 |
| columnId   | string | 是   | 列 ID            |

**响应格式**：[`ApiResponseForChat<GenerateColumnNameResponse>`](../通用返回数据文档.md#三聊天响应结构-apiresponseforchat)

**响应参数**：

| 参数名 | 类型   | 描述            |
| ------ | ------ | --------------- |
| msg    | string | AI 生成的列名称 |

**响应示例**：

```json
{
  "result": {
    "msg": "AI生成列名"
  },
  "message": "操作成功",
  "status": "success",
  "ErrorCode": 0
}
```

## 五、其他操作接口

### 1. 表格操作

**接口路径**：`excel/operation`

**请求参数**：

| 参数名      | 类型                                   | 必填 | 描述             |
| ----------- | -------------------------------------- | ---- | ---------------- |
| cmd         | [OperationCommand](./excel操作命令.md) | 是   | 操作命令         |
| payload     | object                                 | 否   | 操作参数         |
| operationNo | number                                 | 是   | 操作序号         |
| sheetId     | string                                 | 是   | Sheet 的唯一标识 |

**注意**：有关 `OperationCommand` 命令类型及对应 payload 参数的详细说明，请参考 [Excel 操作命令详细文档](./excel操作命令.md)。

**响应格式**：[`ApiResponseForChat<TableOperationResponse>`](../通用返回数据文档.md#三聊天响应结构-apiresponseforchat)

**响应参数**：

| 参数名   | 类型     | 描述             |
| -------- | -------- | ---------------- |
| code     | number   | 状态码           |
| msg      | string   | 操作结果描述信息 |
| result   | any      | 结果数据         |
| rowId    | string   | 行 ID            |
| columnId | string   | 列 ID            |
| rowIds   | string[] | 行 ID 数组       |

**响应示例**：

```json
{
  "result": {
    "code": 0,
    "msg": "操作执行成功",
    "columnId": "column_003"
  },
  "message": "操作成功",
  "status": "success",
  "ErrorCode": 0
}
```

### 2. 获取单元格任务状态

**接口路径**：`excel/getCellsStatus`

**请求参数**：

| 参数名  | 类型     | 必填 | 描述             |
| ------- | -------- | ---- | ---------------- |
| cellIds | string[] | 是   | 单元格 ID 数组   |
| sheetId | string   | 是   | Sheet 的唯一标识 |

**响应格式**：[`ApiResponseForChat<{data: GetCellsStatusResponse}>`](../通用返回数据文档.md#三聊天响应结构-apiresponseforchat)

**响应参数**：

| 参数名     | 类型             | 描述             |
| ---------- | ---------------- | ---------------- |
| data       | object           | 数据对象         |
| data.cells | CellStatusItem[] | 单元格状态项数组 |

**CellStatusItem 结构**：

| 参数名         | 类型           | 描述       |
| -------------- | -------------- | ---------- |
| cellId         | string         | 单元格 ID  |
| columnId       | string         | 列 ID      |
| rowId          | string         | 行 ID      |
| status         | CellStatusEnum | 单元格状态 |
| processedValue | string         | 处理后的值 |

**响应示例**：

```json
{
  "result": {
    "data": {
      "cells": [
        {
          "cellId": "cell_001_002",
          "columnId": "column_002",
          "rowId": "row_001",
          "status": 3,
          "processedValue": "互联网"
        },
        {
          "cellId": "cell_002_002",
          "columnId": "column_002",
          "rowId": "row_002",
          "status": 2,
          "processedValue": ""
        }
      ]
    }
  },
  "message": "操作成功",
  "status": "success",
  "ErrorCode": 0
}
```

### 3. 获取数据源详情

**接口路径**：`excel/sourceDetail`

**请求参数**：

| 参数名     | 类型           | 必填 | 描述       |
| ---------- | -------------- | ---- | ---------- |
| sourceId   | string         | 是   | 数据源 ID  |
| sourceType | SourceTypeEnum | 是   | 数据源类型 |

**响应格式**：[`ApiResponseForChat<{data: GetSourceDetailResponse}>`](../通用返回数据文档.md#三聊天响应结构-apiresponseforchat)

**响应参数**：根据不同的数据源类型，响应字段会有所不同，详见 type.ts 中的 GetSourceDetailResponse 定义。

**响应示例**：

```json
{
  "result": {
    "data": {
      "sourceId": "source_001",
      "type": 2,
      "createTime": "2023-07-01 10:00:00",
      "updateTime": "2023-07-01 11:00:00",
      "columnName": "行业类型",
      "model": 1,
      "promptPattern": "根据公司名称分析行业类型",
      "question": "如何根据公司名称分析行业类型?",
      "progress": "100%"
    }
  },
  "message": "操作成功",
  "status": "success",
  "ErrorCode": 0
}
```
