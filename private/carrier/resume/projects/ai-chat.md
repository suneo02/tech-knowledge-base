# AI-Chat 智能对话助手 | 2023.08 - 2024.03

> **文档说明**：本文档包含该项目的完整面试准备资料，分为 **[Part 1] 项目档案** (技术事实与深挖) 和 **[Part 2] 口述脚本** (面试表达与话术)。

---

## Part 1: 项目档案 (Dossier)

- **定位**：企业级 AI 助手应用，支持多轮对话、流式响应与结构化数据渲染。
- **角色**：核心开发者，搭建 AI 聊天页面全流程与对话流程。
- **文档基线**：AI Chat 智能对话组件 文档集 v2.0（2025-11-03）

### 1. 全景 (Situation & Task)

#### 业务背景
为金融分析师提供 "Chat-to-Data" 对话入口，用户通过自然语言触发分析报告、图表与结构化数据展示。

#### 架构描述
前端聊天 UI 采用分层架构设计：
-   **UI 层**：负责组件渲染与交互。
-   **状态层**：管理会话状态与消息队列。
-   **逻辑层**：处理业务逻辑与流式解析。
-   **服务层**：对接 SSE 流式通道，完成预处理、流式解析、收敛与追踪，对外通过 BFF 接入后端服务。

#### 技术选型
在对话场景需要流式渲染、对话组件与中断控制能力的前提下，选择 **Ant Design X** 而非自研，以缩短交付周期并集中实现对话流程与结构化输出渲染。

### 2. 关键设计文档 (References)

> 以下文档路径用于面试中的证据溯源：

*   **架构与流程**：
    *   `README.md`：核心能力、模块架构、实现映射。
    *   `design/architecture-design.md`：整体架构、插件化扩展、性能优化。
    *   `design/process-flow.md`：核心流程架构、事件系统。
    *   `private/carrier/assets/gel-workspace/packages/gel-ui/docs/biz/ai-chat/`
*   **消息与渲染**：
    *   `design/message-model-design.md`：消息类型体系、解析流水线。
    *   `design/rendering-system-design.md`：渲染流水线、渲染场景。

### 3. 核心行动 (Actions & Construction)

#### 3.1 核心功能实现
1.  **流式对话流程**：用户输入 -> 发起请求 -> 建立 SSE 连接 -> 解析增量 -> 消息队列 -> 触发渲染 -> 支持中断/恢复。
2.  **结构化渲染**：设计了分层的消息数据结构（基础消息 vs AI 扩展消息），包含角色、内容、渲染配置与交互元数据，驱动多态渲染。
3.  **消息模型**：建立多态解析机制，保证多类型消息（图表/表格/文本）解析与渲染的一致性。

#### 3.2 深挖案例：流式渲染抖动优化 (Scroll Optimization)
*   **现象**：流式输出过程中，DOM 高度变化导致页面抖动与自动上滑，尤其在“内容高度刚超过视口”时明显。
*   **排查**：定位到 DOM 高度变化与浏览器默认的 Scroll Anchoring 策略冲突。
*   **方案 V1 (失败)**：状态驱动。仅在消息状态变化时触发滚动，无法覆盖图片/公式异步加载导致的高度变化。
*   **方案 V2 (最终)**：**维度驱动**。
    *   采用双层容器模型。
    *   利用 `ResizeObserver` 感知内容高度变化。
    *   结合禁用浏览器默认锚定策略，实现仅在用户处于底部时自动吸附。
*   **证据锚点**：
    *   Spec: `private/carrier/assets/gel-workspace/docs/specs/chat-scroll-optimization/advanced-scroll-spec.md`
    *   Code: `packages/gel-ui/src/hooks/useScrollToBottom.ts`

### 4. 结果 (Results)

*   **交付成果**：成功落地 Ant Design X 方案，搭建了完整的 AI 聊天页面全流程。
*   **技术沉淀**：设计了通用的消息解析与渲染映射机制，支撑了结构化输出需求。
*   **体验提升**：彻底解决了流式渲染中的页面抖动问题，确保了阅读连续性。

---

## Part 2: 面试口述脚本 (Script)

> **提示**：本脚本用于面试中的口述表达，已根据档案内容进行校准。

### 1. 电梯演讲 (The Hook / 60s)

"这是一个为金融分析师打造的 'Chat-to-Data' 工具。
我作为核心开发者，负责搭建**AI 聊天页面的全流程**。
项目最大的挑战在于**流式交互的体验**：用户需要一边看数据一边对话，但大模型流式输出时，复杂的结构化数据（如图表、表格）会导致 DOM 高度剧烈变化，产生页面抖动。
为此，我基于 **Ant Design X** 设计了一套分层的消息渲染架构，并重点实施了**维度驱动的滚动优化**方案。
最终实现了丝滑的流式对话体验，并沉淀了一套通用的消息解析与渲染机制。"

### 2. 深度展开 (The Deep Dive - STAR+)

#### S (Situation) & T (Task)
"我们的场景比较复杂，不仅是纯文本，还有大量的结构化数据。
我的核心任务是：在保证交付节奏的前提下，解决流式输出带来的渲染不稳定和交互卡顿问题。"

#### A (Action)

**关键点 1：架构分层与选型**
"为了快速支持多轮对话和中断控制，我选型了 Ant Design X。
但我做了深度的架构分层：将前端拆分为 UI 层、状态层、逻辑层和服务层。
服务层专门负责 SSE 的流式解析和收敛，这样 UI 层只需要关心渲染，不需要处理复杂的流状态，保证了代码的可维护性。"

**关键点 2：维度驱动的滚动优化 (Dimension-Driven Scroll)**
"这是最头疼的问题。流式生成时，浏览器默认的 Scroll Anchoring 经常失效，导致页面乱跳。
我尝试过用 State 驱动滚动，但失败了，因为无法覆盖图片异步加载的情况。
最终我设计了**维度驱动**方案：
利用 `ResizeObserver` 实时监听消息容器的高度变化。
配合双层容器模型，只有当检测到用户‘确实’停留在底部时，才触发吸附滚动。
这比依赖浏览器的默认行为要可靠得多。"

#### R (Result)
"结果非常明显，页面抖动完全消失了，无论 AI 生成多快，阅读体验都很稳定。这套滚动逻辑后来也被抽离成了 `useScrollToBottom` Hook，复用到了其他项目中。"

### 3. 防御性问答 (Defensive Q&A)

#### Q1: 为什么强调“维度驱动”而不是“数据驱动”滚动？
**A**: "因为在流式场景下，数据的更新和 DOM 的实际渲染是异步的。有时候数据变了，但 DOM 还没撑开；或者图片加载了，DOM 撑开了但数据没变。‘维度驱动’直接监听 DOM 的物理尺寸（ResizeObserver），是最接近用户真实视觉体验的指标，能覆盖所有导致高度变化的场景。"

#### Q2: 既然用了 Ant Design X，为什么还需要自己设计消息模型？
**A**: "Ant Design X 提供了基础的 UI 骨架，但我们的业务数据结构很复杂（包含图表配置、追溯信息等）。我们需要一个多态解析层，把后端返回的异构数据，标准化为 UI 组件能消费的 Props，这样才能实现灵活的结构化渲染。"