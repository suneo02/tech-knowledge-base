# report-util è®¾è®¡æ–‡æ¡£

## ğŸ¯ æ¦‚è§ˆ

**åŠŸèƒ½èŒƒå›´**: ä¸ºæŠ¥å‘Šç³»ç»Ÿæä¾›åº•å±‚å·¥å…·å‡½æ•°ï¼Œæ”¯æ’‘æ•°æ®æ ¼å¼åŒ–ã€è¡¨æ ¼å¤„ç†ã€æ ‘çŠ¶æ“ä½œç­‰æ ¸å¿ƒèƒ½åŠ›ã€‚

**ç›®æ ‡ç”¨æˆ·**: å‰ç«¯æŠ¥å‘Šé¢„è§ˆç»„ä»¶ (`report-preview-ui`)ã€åç«¯PDFæ‰“å°æœåŠ¡ (`report-print`) çš„å¼€å‘è€…ã€‚

**å…³é”®ç”¨ä¾‹**:
- ç¡®ä¿é¢„è§ˆä¸æ‰“å°çš„æ•°æ®æ ¼å¼åŒ–ä¸€è‡´æ€§
- æä¾›å®‰å…¨çš„HTMLå¤„ç†ï¼Œé˜²æ­¢XSSæ”»å‡»
- æ”¯æŒæŠ¥å‘Šé…ç½®åœ¨é¡µé¢é—´çš„URLä¼ é€’

## ğŸ—ï¸ ä¿¡æ¯æ¶æ„

```mermaid
graph TD
    subgraph "æ¶ˆè´¹æ–¹"
        A["report-preview-ui<br/>å‰ç«¯é¢„è§ˆ"] --> E["report-util"]
        B["report-print<br/>åç«¯æ‰“å°"] --> E
    end

    subgraph "æ¨¡å—å…¥å£ç‚¹"
        E --> F["format<br/>æ•°æ®æ ¼å¼åŒ–"]
        E --> G["table<br/>è¡¨æ ¼å¤„ç†"]
        E --> H["tree<br/>æ ‘ç»“æ„æ“ä½œ"]
        E --> I["misc<br/>é€šç”¨å·¥å…·"]
        E --> J["constants<br/>å…±äº«å¸¸é‡"]
        E --> K["url<br/>URLå¤„ç†"]
    end

    subgraph "å¤–éƒ¨ä¾èµ–"
        E --> L["gel-types<br/>ç±»å‹å®šä¹‰"]
        E --> M["lz-string<br/>å‚æ•°å‹ç¼©"]
    end

    style E fill:#D5E8D4,stroke:#82B366,font-weight:bold
```

**è·¯ç”±/å…¥å£è¯´æ˜**: é€šè¿‡ package.json çš„ `exports` å­—æ®µå®šä¹‰å¤šä¸ªæ¨¡å—å…¥å£ç‚¹ï¼Œæ”¯æŒæŒ‰éœ€å¯¼å…¥ã€‚

## ğŸ¨ æ¨¡å—è“å›¾

| æ¨¡å— | æ ¸å¿ƒèŒè´£ | è¾“å…¥ | è¾“å‡º | çŠ¶æ€å¤„ç† |
| :--- | :--- | :--- | :--- | :--- |
| **format** | æ•°æ®æ ¼å¼åŒ– | æ•°å€¼ã€é…ç½® | æ ¼å¼åŒ–å­—ç¬¦ä¸² | å®¹é”™è¿”å›`'--'` |
| **table** | è¡¨æ ¼é…ç½®å¤„ç† | åŸå§‹é…ç½® | æ ‡å‡†åŒ–é…ç½® | åŠ è½½/ç©º/é”™è¯¯ |
| **tree** | æ ‘çŠ¶æ€ç®¡ç† | èŠ‚ç‚¹ã€çŠ¶æ€ | éšè—èŠ‚ç‚¹æ•°ç»„ | çŠ¶æ€ä¼ æ’­ |
| **misc** | é€šç”¨å·¥å…· | å„ç§æ•°æ® | å¤„ç†ç»“æœ | å®‰å…¨è¿‡æ»¤ |

## ğŸ”„ ä»»åŠ¡æµç¨‹

### æ•°æ®æ ¼å¼åŒ–æµç¨‹
```mermaid
flowchart LR
    A["åŸå§‹æ•°æ®"] --> B{"æ•°æ®ç±»å‹åˆ¤æ–­"}
    B -->|æ•°å€¼| C["formatNumber"]
    B -->|è´§å¸| D["formatCurrency"]
    B -->|æ—¥æœŸ| E["formatDate"]
    C --> F["æ ¼å¼åŒ–ç»“æœ"]
    D --> F
    E --> F
    F --> G["æ˜¾ç¤ºè¾“å‡º"]
```

### å®‰å…¨å¤„ç†æµç¨‹
```mermaid
flowchart TD
    A["ç”¨æˆ·HTML"] --> B["replaceScript"]
    B --> C{"å±é™©æ ‡ç­¾?"}
    C -->|æ˜¯| D["ç§»é™¤å±é™©å†…å®¹"]
    C -->|å¦| E["ä¿ç•™å®‰å…¨å†…å®¹"]
    D --> F["å®‰å…¨HTML"]
    E --> F
    F --> G["PDFç”Ÿæˆ"]
```

## ğŸ“Š æ•°æ®æµ

| æ¨¡å— | è¾“å…¥ | è¾“å‡º | é”™è¯¯å¤„ç† |
| :--- | :--- | :--- | :--- |
| **format** | æ•°å€¼ã€é…ç½® | æ ¼å¼åŒ–å­—ç¬¦ä¸² | è¿”å›`'--'` |
| **tree** | èŠ‚ç‚¹ã€çŠ¶æ€ | éšè—èŠ‚ç‚¹æ•°ç»„ | ç±»å‹æ ¡éªŒ |
| **misc** | å„ç§æ•°æ® | å¤„ç†ç»“æœ | å®‰å…¨è¿‡æ»¤ |

## ğŸ§© ç»„ä»¶å¤ç”¨

### æ¨¡å—ä¾èµ–å…³ç³»
```mermaid
graph TD
    A["report-util"] --> B["format"]
    A --> C["misc"]
    A --> D["table"]
    D --> B
    D --> C
    E["tree"] --> C
    F["url"] --> C

    style A fill:#D5E8D4,stroke:#82B366,font-weight:bold
```

## ğŸ“– ä»£ç å…³è”

- [æ ¼å¼åŒ–æ ¸å¿ƒ](../src/format/formatNumber.ts) - æ•°å€¼æ ¼å¼åŒ–ç®—æ³•
- [å®‰å…¨å¤„ç†æ ¸å¿ƒ](../src/misc/replaceScript.ts) - XSSé˜²æŠ¤å®ç°
- [æŠ€æœ¯çº¦æŸè¯´æ˜](./technical-constraints.md) - wkhtmltopdfå…¼å®¹è¦æ±‚
- [æµ‹è¯•è¦†ç›–](../src/__test__/) - å„æ¨¡å—å•å…ƒæµ‹è¯•

---

*è®¾è®¡æ–‡æ¡£ä¸ä»£ç åŒæ­¥ï¼Œé‡å¤§å˜æ›´éœ€åŒæ­¥æ›´æ–°ã€‚*