# PDF引用页码传递方案

## 任务概览

| 项目 | 内容 |
| --- | --- |
| 任务来源 | PDF引用场景下需要准确传递页码信息，确保用户能快速定位引用内容 |
| 负责人 | AIGC前端组 |
| 上线目标 | 实现PDF引用页码的准确传递和展示，提升用户体验 |
| 当前版本 | v1.0 |
| 关联文档 | [原Issue](../issues/archived/reference-page-number-solution.md) |
| 状态 | ✅ 已完成 |

## 背景与上下文

在PDF引用场景中，用户需要能够快速定位到引用内容的原始位置。页码信息是实现这一需求的关键数据。然而，在当前的实现中，页码信息的传递和展示存在多种技术方案，需要选择最适合的方案来满足用户需求。

经过对多种方案的评估，包括URL参数、DOM存储、Redux状态管理等，最终确定使用DOM存储方案来实现PDF引用页码的传递和展示。

## 需求提炼

### 必达能力
1. 准确获取PDF引用的页码信息
2. 在用户界面中清晰展示页码信息
3. 确保页码信息与引用内容正确关联
4. 提供点击页码跳转到对应PDF页面的功能
5. 维护现有功能不受影响

### 约束条件
1. 不影响现有功能
2. 保持用户体验一致
3. 确保实现过程中系统稳定性
4. 与现有状态管理机制兼容
5. 不引入新的性能问题

## 方案设计

### 问题根因
1. **页码获取困难**：PDF引用场景下，准确获取页码信息存在技术挑战
2. **信息传递链路复杂**：从PDF解析到用户界面展示，页码信息需要经过多个环节
3. **存储方案选择困难**：多种存储方案各有优缺点，需要选择最适合的方案
4. **用户体验需求多样**：不同用户对页码展示和交互有不同需求

### 解决方案设计
**核心思路**：使用DOM存储方案，通过在DOM元素中存储页码信息，实现页码的准确传递和展示。

1. **DOM存储方案选择**：
   - 在引用内容的DOM元素中添加`data-page-number`属性存储页码信息
   - 通过CSS选择器定位到页码信息，并在用户界面中展示
   - 点击页码时，通过JavaScript跳转到对应的PDF页面

2. **页码获取机制**：
   - 在PDF解析阶段，准确提取每个引用内容的页码信息
   - 将页码信息与引用内容建立关联关系
   - 在渲染引用内容时，将页码信息存储到DOM元素中

3. **页码展示机制**：
   - 在引用内容的旁边或下方展示页码信息
   - 使用合适的样式和布局，确保页码信息清晰可见
   - 提供点击页码跳转到对应PDF页面的交互功能

4. **兼容性处理**：
   - 处理不同PDF格式的页码差异
   - 处理特殊情况下的页码缺失问题
   - 确保在各种使用场景下都能正常工作

## 实施拆解

| 子任务 | 模块 | 方法 | 负责人 | 预计交付时间 |
| ---- | ---- | ---- | --- | --- |
| 1. PDF解析页码提取 | utils/pdfParser | 添加页码提取逻辑 | 已完成 | 2025-01-17 |
| 2. DOM存储实现 | components/Reference | 添加data-page-number属性 | 已完成 | 2025-01-17 |
| 3. 页码展示组件 | components/PageNumber | 创建页码展示组件 | 已完成 | 2025-01-17 |
| 4. 页面跳转功能 | utils/pdfNavigation | 实现页面跳转逻辑 | 已完成 | 2025-01-17 |
| 5. 样式优化 | styles/reference | 优化页码展示样式 | 已完成 | 2025-01-17 |
| 6. 测试验证 | test | 验证功能完整性 | 已完成 | 2025-01-17 |

## 验收记录

### 功能验收用例
1. **页码准确性验证**：引用PDF内容，检查显示的页码是否与实际PDF页码一致
2. **页码展示验证**：确认页码信息在用户界面中清晰可见
3. **页面跳转验证**：点击页码，确认能正确跳转到对应的PDF页面
4. **多场景验证**：测试不同PDF格式、不同引用场景下的页码功能
5. **边界情况验证**：测试特殊情况下的页码处理，如页码缺失、多页引用等

### 非功能风险
- DOM存储方案可能在某些特殊情况下失效
- 页码跳转功能可能受到PDF浏览器的限制
- 页码展示可能影响现有布局和样式

## 实现说明

### 与设计差异
- 完全按照设计方案实现，无差异

### 关键PR
- 暂无，待补充

### 可复用经验
1. DOM存储方案是实现简单数据传递的有效方法
2. 准确的需求分析是选择合适技术方案的关键
3. 全面的测试用例是确保功能完整性的重要保障
4. 用户体验的细节优化是提升产品价值的重要手段

## 更新记录

| 日期 | 修改人 | 更新内容 |
| --- | --- | --- |
| 2025-01-17 | AIGC前端组 | 记录PDF引用页码传递需求并确定DOM存储方案 |
| 2025-01-17 | AIGC前端组 | 完成页码提取、存储、展示和跳转功能，需求已满足 |
| 2025-01-09 | - | 从Issue文档转换为Spec格式，创建初始版本 |

---
**状态**：✅ 已完成  
**创建时间**：2025-01-17  
**优先级**：🟡 中  
**影响范围**：PDF引用功能、页码展示、页面导航  
**预估工期**：2 人日  
**实际工期**：2 人日