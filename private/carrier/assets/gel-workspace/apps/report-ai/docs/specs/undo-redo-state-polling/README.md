# Undo/Redo 状态轮询问题

> 📖 本文档遵循 [Issue 文档编写规范](../../../../../docs/rule/issue-doc-rule.md)

## 问题概览

| 字段         | 内容                                                  |
| ------------ | ----------------------------------------------------- |
| 问题         | 使用定时器轮询获取 undo/redo 状态，应改用事件监听机制 |
| 状态         | 🚧 进行中                                             |
| 优先级       | 🟡 P1                                                 |
| 责任人       | -                                                     |
| 发现时间     | 2025-10-22                                            |
| 预期解决时间 | 2025-10-24                                            |

## 文档索引

| 文档                            | 阶段     | 状态 | 说明                   |
| ------------------------------- | -------- | ---- | ---------------------- |
| [问题分析](./issue-analysis.md) | 问题分析 | ✅   | 现象、根因、影响       |
| [解决方案](./solution.md)       | 方案设计 | ✅   | 事件驱动方案与实施步骤 |
| [验证计划](./verification.md)   | 验证测试 | 🚧   | 验证步骤与性能对比     |

## 快速导航

- **核心问题**：使用 `setInterval` 每 500ms 轮询 undo/redo 状态，性能浪费
- **推荐方案**：扩展 EditorFacade 事件类型，使用事件监听机制
- **预期效果**：消除 95% 的无效调用，提升响应速度

## 待办事项

- [ ] 扩展 EditorFacade 事件类型定义
- [ ] 在 EditorFacade 中监听 undoManager 事件
- [ ] 创建 useUndoRedoState Hook
- [ ] 替换 ReportContent 中的轮询逻辑
- [ ] 添加单元测试验证事件触发

## 更新日志

| 日期       | 事件 | 描述                                      |
| ---------- | ---- | ----------------------------------------- |
| 2025-10-29 | 重构 | 按照 Issue 规范拆分文档，创建索引与子文档 |
| 2025-10-22 | 创建 | 初始创建，识别轮询问题并提出事件驱动方案  |

## 相关文档

- [Issue 文档编写规范](../../../../../docs/rule/issue-doc-rule.md)
- [React 组件规范](../../../../../docs/rule/react-rule.md)
- [TypeScript 编码规范](../../../../../docs/rule/typescript-rule.md)
