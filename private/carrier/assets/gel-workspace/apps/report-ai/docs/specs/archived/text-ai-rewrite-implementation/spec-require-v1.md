# 需求与背景 - 文本 AI 重写

> 📖 回链：[任务概览](./README.md) | 阶段：需求分析

## 业务背景

用户需要对选中文本进行局部优化改写，章节级生成过于笨重。需要提供选区级的精细化智能编辑能力。

**现有能力**：章节级 AIGC、流式预览、注水机制、TinyMCE 选区 API

**遗留问题**：缺少选区级编辑、无快照恢复机制

## 核心场景

### 场景 1：段落优化

用户选中 50-500 字符文本 → 触发改写 → 实时预览 → 确认替换

### 场景 2：句子润色

用户选中句子 → 智能扩展边界 → AI 改写 → 快速撤销

### 场景 3：批量优化

连续改写多个段落 → 自动标记脏状态 → 触发保存

## 核心需求

| 编号  | 需求描述           | 优先级 | 验收标准                                                |
| ----- | ------------------ | ------ | ------------------------------------------------------- |
| FR-01 | 选区合法性验证     | P0     | 仅在正文区域内、10-2000 字符、具备上下文                |
| FR-02 | 快照保存与恢复     | P0     | 改写失败可恢复原选区，快照 60 秒内有效                  |
| FR-03 | 改写请求编排       | P0     | 与 `globalOperation` 状态保持一致，禁止并发改写         |
| FR-04 | 预览与确认入口     | P0     | 触发独立悬浮预览并等待确认，细节见预览组件 Spec         |
| FR-05 | 一次性替换与脏标记 | P0     | 确认后替换选区并立即触发 `hasDirty`                     |
| FR-06 | 会话重置           | P0     | 每次开始前执行 `resetSession`，清空消息、预览与状态缓存 |
| FR-07 | 中止与拒绝区分     | P0     | 暴露流式中止与完成后拒绝两个接口，执行后均保证完整清理  |
| FR-08 | 流式消息隔离       | P0     | 改写消息不得进入 `useStreamingPreview` 注水流程         |
| FR-09 | 快捷操作           | P1     | 支持快捷键触发与取消，提供显式按钮备选                  |

## 约束条件

- 选区长度：10-2000 字符
- 上下文：前后各 100 字符
- 并发限制：同时仅一个改写

## 相关文档

- [文本 AI 重写场景](../../RPDetail/ContentManagement/text-ai-rewrite-flow.md)
- [AIGC 核心流程](../../RPDetail/ContentManagement/aigc-core-flow.md)

## 更新记录

| 日期       | 修改人 | 更新内容                       |
| ---------- | ------ | ------------------------------ |
| 2025-11-04 | Codex  | 补充会话重置/中断/隔离相关需求 |
| 2025-10-29 | Kiro   | 精简至 100 行                  |
