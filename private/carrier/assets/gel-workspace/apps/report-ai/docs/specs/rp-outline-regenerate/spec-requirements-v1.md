---
title: 报告大纲重新生成 - 需求分析
version: v1
status: ✅ 已完成
---

# 需求分析 v1

[← 返回任务概览](/docs/specs/rp-outline-regenerate/README.md)

## 背景

当前报告大纲生成流程中，用户在生成大纲后如果不满意，只能返回首页重新开始，需要重新输入问题和上传文件。这种体验不够友好，影响用户的使用效率。

### 现状

- 操作区已有"重新生成"按钮 UI
- 按钮状态管理已实现（`isRegenerateDisabled`）
- `handleRegenerate` 函数仅有 TODO 占位

@see apps/report-ai/src/components/ChatRPOutline/OperationArea/hooks/useOperationActions.ts:68

## 用户场景

### 场景 1：大纲不满意，需要重新生成

**前置条件**：

- 用户已生成大纲
- 大纲内容不符合预期

**操作流程**：

1. 用户点击"重新生成"按钮
2. 系统使用原问题和文件重新发送请求
3. 系统生成新的大纲
4. 用户查看新大纲

**预期结果**：

- 保持原有问题和文件上下文
- 生成新的大纲内容
- 旧大纲被新大纲替换

### 场景 2：生成过程中的状态管理

**前置条件**：

- 用户点击"重新生成"

**操作流程**：

1. 按钮进入禁用状态
2. 显示生成中状态
3. 生成完成后恢复可用

**预期结果**：

- 防止重复点击
- 提供清晰的状态反馈

## 功能需求

### FR-1：重新发送最后一个用户问题

- 系统应从 ref 中获取最后一次发送的消息
- 使用相同的参数重新发送请求
- 保留完整的对话历史

### FR-2：状态同步

- 重新生成时禁用相关操作按钮
- 生成完成后恢复按钮状态
- 与现有的 `isChating` 状态协同工作

## 非功能需求

### NFR-1：性能

- 重新生成响应时间与首次生成一致
- 不应有额外的性能开销

### NFR-2：可靠性

- 处理边界情况（无用户消息、消息格式异常等）
- 提供错误提示

### NFR-3：可维护性

- 代码逻辑清晰
- 复用现有的消息发送机制
- 遵循项目代码规范

## 约束条件

1. **技术约束**：

   - 使用现有的 `sendMessage` 方法
   - 使用现有的 `setMessages` 方法
   - 不修改消息数据结构

2. **业务约束**：
   - 仅在有大纲时可用
   - 生成过程中不可用
   - 与其他操作互斥

## 验收标准

- [ ] 点击"重新生成"按钮后，使用原问题和文件重新生成大纲
- [ ] 保留完整的对话历史
- [ ] 按钮状态正确（禁用/启用）
- [ ] 边界情况处理正确（ref 为 null 等）
- [ ] 代码符合 TypeScript 和 React 规范

## 相关文档

- [方案设计 v1](/docs/specs/rp-outline-regenerate/spec-design-v1.md)
- [实施计划 v1](/docs/specs/rp-outline-regenerate/spec-implementation-v1.md)
