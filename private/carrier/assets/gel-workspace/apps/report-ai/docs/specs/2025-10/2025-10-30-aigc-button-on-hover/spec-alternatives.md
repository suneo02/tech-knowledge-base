# 方案对比与选型

> 📋 [返回任务概览](./README.md) | 📝 [需求文档](./spec-require-v1.md)

## 问题定义

**核心需求**：鼠标悬停在 leaf chapter 标题时显示按钮，非 leaf chapter 隐藏所有按钮。

**关键约束**：

- TinyMCE 运行在 iframe 中，不允许修改正文 DOM
- 需要与现有外部渲染体系解耦
- 需要兼容多实例、亮/暗主题

**主要挑战**：

- 精准检测鼠标位置对应的章节
- 判断章节是否为 leaf chapter
- 精确计算按钮定位（包含 iframe 偏移）

## 方案对比

| 方案   | 核心技术                     | 性能   | 复杂度 | 维护性 | 结论     |
| ------ | ---------------------------- | ------ | ------ | ------ | -------- |
| 方案 1 | mousemove + elementFromPoint | ⭐⭐⭐ | ⭐     | ⭐⭐⭐ | ⭐️ 推荐 |
| 方案 2 | Map 缓存 + Y 坐标遍历        | ⭐⭐   | ⭐⭐   | ⭐⭐   | 备选     |

## 方案详情

### 方案 1：mousemove + elementFromPoint ⭐️

**思路**：监听 mousemove，用 elementFromPoint 检测鼠标位置元素，向上查找标题，判断是否为 leaf chapter。

| 维度     | 评估                             |
| -------- | -------------------------------- |
| 场景覆盖 | ✅ 完全满足需求                  |
| 性能     | ⭐⭐⭐ O(1) 检测，与章节数量无关 |
| 复杂度   | ⭐ 逻辑简单，约 100 行           |
| 维护性   | ⭐⭐⭐ 逻辑清晰，易于调试        |

### 方案 2：Map 缓存 + Y 坐标遍历

**思路**：缓存所有标题元素位置，mousemove 时遍历判断 Y 坐标范围。

| 维度     | 评估                              |
| -------- | --------------------------------- |
| 场景覆盖 | ✅ 满足需求                       |
| 性能     | ⭐⭐ O(n) 遍历，章节多时有开销    |
| 复杂度   | ⭐⭐ 需维护 MutationObserver 同步 |
| 维护性   | ⭐⭐ 章节增删需要额外同步         |

## 推荐方案

**选型**：方案 1 - mousemove + elementFromPoint

**理由**：

1. 性能稳定，O(1) 检测
2. 逻辑简单，易于维护
3. 无需维护缓存，避免同步问题

## 更新记录

| 日期       | 修改人 | 更新内容                         |
| ---------- | ------ | -------------------------------- |
| 2025-11-05 | Kiro   | 简化方案对比，聚焦核心需求       |
| 2025-11-XX | Codex  | 根据需求变更重新评估方案         |
| 2025-10-31 | Codex  | 重新评估方案，补充需求与设计约束 |
