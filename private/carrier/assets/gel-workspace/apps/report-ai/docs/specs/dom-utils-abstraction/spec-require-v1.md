---
title: DOM æ“ä½œå·¥å…·æŠ½è±¡ - éœ€æ±‚æç‚¼
version: v1
status: ğŸš§ è¿›è¡Œä¸­
---

[â† è¿”å›ä»»åŠ¡æ¦‚è§ˆ](/apps/report-ai/docs/specs/dom-utils-abstraction/README.md)

# éœ€æ±‚æç‚¼

## æ ¸å¿ƒé—®é¢˜

domain å±‚å­˜åœ¨å¤§é‡åˆ†æ•£çš„ DOM æ“ä½œï¼Œç¼ºä¹ç»Ÿä¸€æŠ½è±¡ï¼š

| æ¨¡å—                  | æ–‡ä»¶                          | é—®é¢˜                               |
| --------------------- | ----------------------------- | ---------------------------------- |
| contentSanitizer      | editor/contentSanitizer.ts:44 | é‡å¤åˆ›å»ºä¸´æ—¶å®¹å™¨ã€æ‰‹åŠ¨æŸ¥è¯¢ç§»é™¤èŠ‚ç‚¹ |
| chapter/render        | chapter/render.ts:120         | æ ‡é¢˜è½¬æ¢é€»è¾‘é‡å¤ã€DOM æ“ä½œåˆ†æ•£     |
| chapterOrdinal/render | chapterOrdinal/render.ts:45   | èŠ‚ç‚¹åˆ›å»ºç¼ºå°‘ç±»å‹çº¦æŸ               |
| document/parse        | document/parse.ts:152         | Fragment è½¬ HTML æ‰‹åŠ¨æ“ä½œ          |
| chapterId/ensureIds   | chapterId/ensureIds.ts:84     | æŸ¥è¯¢å’Œéå†ä»£ç å†—ä½™                 |

## ä¸šåŠ¡åœºæ™¯

| åœºæ™¯          | å½“å‰å®ç°                                              | éœ€æ±‚                           |
| ------------- | ----------------------------------------------------- | ------------------------------ |
| HTML å†…å®¹æ¸…æ´— | åˆ›å»º div â†’ è®¾ç½® innerHTML â†’ æŸ¥è¯¢ç§»é™¤ â†’ æå– innerHTML | ä¸´æ—¶å®¹å™¨è‡ªåŠ¨ç®¡ç†ã€ä¾¿æ·æŸ¥è¯¢ç§»é™¤ |
| æ ‡é¢˜å…ƒç´ è½¬æ¢  | æŸ¥è¯¢æ ‡é¢˜ â†’ åˆ›å»ºæ–°å…ƒç´  â†’ è®¾ç½®å†…å®¹ â†’ æ›¿æ¢               | æ‰¹é‡è½¬æ¢ã€å£°æ˜å¼åˆ›å»º           |
| ç« èŠ‚åºå·èŠ‚ç‚¹  | åˆ›å»º span â†’ è®¾ç½®å±æ€§ â†’ è®¾ç½®æ–‡æœ¬                       | ç±»å‹å®‰å…¨çš„å…ƒç´ åˆ›å»º             |
| æ–‡æ¡£è§£æ      | æŸ¥è¯¢æ‰€æœ‰æ ‡é¢˜ â†’ éå†å¤„ç† â†’ Fragment è½¬ HTML            | ç±»å‹å®‰å…¨æŸ¥è¯¢ã€ç›´æ¥è½¬æ¢         |

## åŠŸèƒ½éœ€æ±‚

| ç¼–å· | éœ€æ±‚            | è¯´æ˜                                          | ä¼˜å…ˆçº§ |
| ---- | --------------- | --------------------------------------------- | ------ |
| FR1  | ä¸´æ—¶å®¹å™¨ç®¡ç†    | åˆ›å»ºä¸´æ—¶ DOM å®¹å™¨ç”¨äº HTML è§£æï¼Œè‡ªåŠ¨æ¸…ç†èµ„æº | P0     |
| FR2  | å…ƒç´ åˆ›å»ºä¸æ“ä½œ  | ç±»å‹å®‰å…¨çš„å…ƒç´ åˆ›å»ºã€å±æ€§è®¾ç½®ã€æ›¿æ¢ã€ç§»é™¤      | P0     |
| FR3  | å…ƒç´ æŸ¥è¯¢ä¸éå†  | ç±»å‹å®‰å…¨çš„æŸ¥è¯¢ã€æ‰¹é‡éå†ã€æ˜ å°„æ–¹æ³•            | P0     |
| FR4  | HTML å­—ç¬¦ä¸²å¤„ç† | HTML ä¸ DOM äº’è½¬ã€Fragment è½¬æ¢               | P0     |

## éåŠŸèƒ½éœ€æ±‚

| ç¼–å· | éœ€æ±‚     | è¯´æ˜                                    | éªŒæ”¶æ ‡å‡†                      |
| ---- | -------- | --------------------------------------- | ----------------------------- |
| NFR1 | å¯æµ‹è¯•æ€§ | æ”¯æŒä¾èµ–æ³¨å…¥ï¼Œä¾¿äºå•å…ƒæµ‹è¯•              | æ‰€æœ‰å‡½æ•°å¯ä¼ å…¥è‡ªå®šä¹‰ document |
| NFR2 | ç±»å‹å®‰å…¨ | TypeScript ä¸¥æ ¼ç±»å‹ï¼Œå…ƒç´ æ ‡ç­¾ä¸ç±»å‹å…³è” | æ—  any ç±»å‹ï¼Œæ”¯æŒç±»å‹æ¨å¯¼     |
| NFR3 | æ€§èƒ½     | é¿å…ä¸å¿…è¦çš„ DOM æ“ä½œï¼Œæ‰¹é‡æ“ä½œä¼˜åŒ–     | æ— æ€§èƒ½å›å½’                    |
| NFR4 | å…¼å®¹æ€§   | ä¸ç°æœ‰ EditorFacade å…¼å®¹ï¼Œæ¸è¿›å¼è¿ç§»    | ä¸ç ´åç°æœ‰åŠŸèƒ½                |

## çº¦æŸæ¡ä»¶

1. **ä¸æ”¹å˜ç°æœ‰è¡Œä¸º**ï¼šå·¥å…·å‡½æ•°ä»…åšæŠ½è±¡ï¼Œä¸æ”¹å˜ä¸šåŠ¡é€»è¾‘
2. **ä¿æŒå‘åå…¼å®¹**ï¼šç°æœ‰ä»£ç å¯ä»¥é€æ­¥è¿ç§»ï¼Œä¸å¼ºåˆ¶ä¸€æ¬¡æ€§æ›¿æ¢
3. **éµå¾ªé¡¹ç›®è§„èŒƒ**ï¼šç¬¦åˆé¡¹ç›®ç»“æ„è§„èŒƒå’Œ TypeScript è§„èŒƒ
4. **æµ‹è¯•è¦†ç›–**ï¼šæ–°å¢å·¥å…·å‡½æ•°éœ€è¦é…å¥—æµ‹è¯•ï¼Œè¦†ç›–ç‡ >90%

## éªŒæ”¶æ ‡å‡†

- [ ] æä¾›å®Œæ•´çš„ DOM æ“ä½œå·¥å…·é›†ï¼ˆcontainerã€elementã€queryã€htmlï¼‰
- [ ] æ‰€æœ‰å·¥å…·å‡½æ•°æœ‰å•å…ƒæµ‹è¯•è¦†ç›–ï¼Œè¦†ç›–ç‡ >90%
- [ ] è‡³å°‘å®Œæˆ 2 ä¸ªæ¨¡å—çš„è¿ç§»éªŒè¯ï¼ˆcontentSanitizerã€chapter/renderï¼‰
- [ ] æ–‡æ¡£å®Œæ•´ï¼ŒåŒ…å« API è¯´æ˜å’Œä½¿ç”¨ç¤ºä¾‹
- [ ] ä¸å½±å“ç°æœ‰åŠŸèƒ½ï¼Œæ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] ä»£ç ç¬¦åˆ TypeScript è§„èŒƒï¼Œæ—  ESLint é”™è¯¯

@see /docs/rule/code-project-structure-rule.md  
@see /apps/report-ai/src/domain/reportEditor/editor/contentSanitizer.ts:44  
@see /apps/report-ai/src/domain/reportEditor/chapter/render.ts:120  
@see /apps/report-ai/src/domain/reportEditor/document/parse.ts:152
