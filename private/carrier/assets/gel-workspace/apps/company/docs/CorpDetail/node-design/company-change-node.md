# 企业变更节点设计

## 概述

企业变更节点用于展示企业的历史变更记录，包括工商变更、股权变更、高管变更等各类变更信息。该节点支持时间轴展示、变更对比和时间筛选等功能，帮助用户了解企业的发展历程。

## 🎯 设计目标

### 业务目标
- 变更类型覆盖：支持工商、股权、高管等各类变更
- 时间轴展示：按时间顺序展示变更记录
- 变更对比：支持变更前后的对比展示
- 时间筛选：支持按时间段筛选变更记录
- 变更统计：提供变更次数统计和趋势分析

### 技术目标
- 配置驱动：通过配置控制变更类型和展示方式
- 时间轴渲染：高效的时间轴组件渲染
- 数据分页：支持大数据量的分页加载
- 性能优化：支持虚拟滚动和数据缓存

## 📋 配置结构

### 基础配置

包含节点标题、唯一标识、API接口、列配置和分页大小等基础信息。

### 特殊配置

| 配置项 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| `supportChangeTypes` | array | 否 | - | 支持的变更类型 |
| `supportTimeFilter` | boolean | 否 | true | 是否支持时间筛选 |
| `supportChangeCompare` | boolean | 否 | true | 是否支持变更对比 |
| `supportTimelineView` | boolean | 否 | true | 是否支持时间轴视图 |
| `defaultViewType` | string | 否 | timeline | 默认视图类型 |

### 交互配置

| 配置项 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| `enableTimeRangeFilter` | boolean | 否 | true | 启用时间范围筛选 |
| `enableChangeTypeFilter` | boolean | 否 | true | 启用变更类型筛选 |
| `enableChangeCompare` | boolean | 否 | true | 启用变更对比功能 |
| `enableTimelineView` | boolean | 否 | true | 启用时间轴视图 |
| `enableListView` | boolean | 否 | true | 启用列表视图 |

## 🏗️ 节点类型定义

### 变更类型

- 工商变更：名称、注册资本、地址、经营范围、法定代表人、公司类型等变更
- 股权变更：股东变更、股权比例变更
- 高管变更：董事变更、监事变更、高管变更
- 其他变更：联系方式变更、网站变更、其他变更

### 变更状态

- PENDING：待审核
- APPROVED：已审核
- REJECTED：已驳回
- CANCELLED：已撤销
- COMPLETED：已完成

### 视图类型

- TIMELINE：时间轴视图
- LIST：列表视图
- COMPARE：对比视图

## 🔧 配置示例

### 基础配置

包含标题、接口、列定义和分页设置的基础配置示例。

### 完整配置

包含特殊配置和交互配置的完整示例，支持多种变更类型、时间筛选和视图切换。

## 🎨 交互设计

### 时间轴视图

按时间顺序展示变更记录，支持缩放和拖动浏览不同时间段的变更。

### 列表视图

以表格形式展示变更记录，支持排序和筛选功能。

### 对比视图

支持变更前后的对比展示，突出显示变更内容。

### 筛选功能

支持时间范围筛选和变更类型筛选，帮助用户快速定位感兴趣的变更记录。
  "ajaxExtras": {
    "companycode": "{{companyCode}}"
  },
  "pageSize": 20
}
```

## 🎨 交互设计

### 视图切换

| 交互元素 | 位置 | 行为 | 说明 |
|----------|------|------|------|
| **视图切换器** | 顶部工具栏 | 按钮组 | timeline/list/compare |
| **时间轴视图** | 内容区域 | 垂直时间轴 | 按时间顺序展示 |
| **列表视图** | 内容区域 | 表格展示 | 传统表格形式 |
| **对比视图** | 内容区域 | 并排对比 | 变更前后对比 |

### 时间筛选

| 交互元素 | 位置 | 行为 | 说明 |
|----------|------|------|------|
| **时间范围选择** | 顶部工具栏 | 日期选择器 | 选择起止时间 |
| **快速筛选** | 时间选择器旁 | 快捷选项 | 近1月/3月/6月/1年 |
| **时间粒度** | 筛选器旁 | 下拉选择 | 日/周/月/年 |

### 类型筛选

| 交互元素 | 位置 | 行为 | 说明 |
|----------|------|------|------|
| **变更类型** | 顶部工具栏 | 多选框 | 选择变更类型 |
| **全选/反选** | 类型选择器旁 | 按钮 | 快速选择 |
| **变更统计** | 筛选器下方 | 数字显示 | 显示各类变更数量 |

### 变更对比

| 交互元素 | 位置 | 行为 | 说明 |
|----------|------|------|------|
| **对比模式** | 对比视图 | 高亮显示 | 差异高亮 |
| **对比控制** | 对比视图顶部 | 按钮控制 | 上一变更/下一变更 |
| **对比导出** | 对比视图工具栏 | 导出按钮 | 导出对比结果 |

## 📡 数据接口

### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `companycode` | string | 是 | 企业代码 |
| `changeTypes` | string[] | 否 | 变更类型筛选 |
| `startDate` | string | 否 | 开始时间 |
| `endDate` | string | 否 | 结束时间 |
| `viewType` | string | 否 | 视图类型 |
| `page` | number | 否 | 页码 |
| `pageSize` | number | 否 | 每页条数 |
| `compareMode` | boolean | 否 | 是否对比模式 |

### 响应数据结构

包含响应状态码、消息和数据，数据中包含总数、变更列表、统计信息、时间轴数据和对比数据等。变更项包含ID、变更类型、变更项目、变更前后值、变更日期、状态、批准日期、备注和附件等属性。统计信息包含总数、按类型统计、按月统计和趋势数据。时间轴项包含日期、变更列表和数量。对比数据包含变更前后数据和差异列表，差异列表包含字段、变更前后值和变更类型。

## ⚡ 性能优化

### 数据缓存策略

| 缓存类型 | 缓存键 | 有效期 | 说明 |
|----------|--------|--------|------|
| **配置缓存** | `config:change:${companyCode}` | 5分钟 | 缓存节点配置 |
| **数据缓存** | `data:change:${companyCode}:${params}` | 3分钟 | 缓存变更数据 |
| **统计缓存** | `stat:change:${companyCode}` | 10分钟 | 缓存统计数据 |
| **时间轴缓存** | `timeline:change:${companyCode}` | 5分钟 | 缓存时间轴数据 |

### 分页优化

| 优化项 | 策略 | 说明 |
|--------|------|------|
| **虚拟滚动** | 数据量>50时启用 | 减少DOM节点数量 |
| **时间轴虚拟化** | 时间轴项目>100时启用 | 优化时间轴渲染 |
| **分页预加载** | 提前加载下一页 | 提升用户体验 |
| **增量加载** | 时间轴滚动加载 | 减少初始加载时间 |

### 渲染优化

| 优化项 | 策略 | 说明 |
|--------|------|------|
| **差异高亮** | 只渲染变更部分 | 减少渲染量 |
| **时间轴懒加载** | 视口内渲染 | 提升滚动性能 |
| **对比视图优化** | 差异计算缓存 | 避免重复计算 |

## 🛡️ 错误处理

### 业务错误

| 错误类型 | 错误码 | 处理策略 | 用户提示 |
|----------|--------|----------|----------|
| **无变更记录** | 404 | 显示空状态 | "暂无企业变更记录" |
| **时间范围错误** | 400 | 重置时间范围 | "时间范围错误，已重置" |
| **变更类型不存在** | 404 | 显示可用类型 | "该变更类型暂无数据" |
| **对比数据缺失** | 404 | 显示单条记录 | "对比数据不完整" |

### 系统错误

| 错误类型 | 处理策略 | 用户提示 |
|----------|----------|----------|
| **时间轴渲染失败** | 降级到列表视图 | "时间轴渲染失败，已切换到列表" |
| **对比计算错误** | 显示原始数据 | "对比计算失败，显示原始数据" |
| **统计数据异常** | 隐藏统计面板 | "统计数据异常，已隐藏统计信息" |

## 📊 数据质量

### 变更可信度

| 置信度 | 标识 | 颜色 | 说明 |
|--------|------|------|------|
| **高(>90%)** | ● | 绿色 | 官方渠道数据 |
| **中(70%-90%)** | ● | 黄色 | 多渠道验证 |
| **低(<70%)** | ● | 红色 | 单一数据源 |

### 数据来源标识

| 数据源 | 标识 | 颜色 | 说明 |
|--------|------|------|------|
| **工商系统** | 工 | 绿色 | 工商登记变更 |
| **公示系统** | 公 | 蓝色 | 企业公示信息 |
| **年报系统** | 年 | 橙色 | 企业年报信息 |
| **第三方** | 三 | 灰色 | 第三方数据 |

## 🔧 扩展设计

### 功能扩展

| 扩展功能 | 配置项 | 说明 |
|----------|--------|------|
| **变更预警** | `enableChangeAlert` | 重要变更预警 |
| **变更订阅** | `enableChangeSubscribe` | 变更消息订阅 |
| **变更导出** | `enableChangeExport` | 变更记录导出 |
| **变更分析** | `enableChangeAnalysis` | 变更趋势分析 |

### 业务扩展

| 扩展业务 | 配置项 | 说明 |
|----------|--------|------|
| **关联企业变更** | `showRelatedChanges` | 显示关联企业变更 |
| **行业变更对比** | `enableIndustryCompare` | 同行业变更对比 |
| **区域变更统计** | `enableRegionStats` | 区域变更统计 |
| **变更影响分析** | `enableImpactAnalysis` | 变更影响分析 |

## 📚 相关文档

- [节点设计规范](./node-design-spec.md) - 通用设计原则
- [配置消费机制](./config-consumption.md) - 配置消费流程
- [CompanyTable组件说明](../company-table.md) - 组件实现参考
- [企业详情页特殊节点配置说明](../special-node-config.md) - 特殊节点配置规范