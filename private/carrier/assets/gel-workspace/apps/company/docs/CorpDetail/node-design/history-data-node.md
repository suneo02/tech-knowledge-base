# 历史数据节点设计

## 概述

历史数据节点用于展示企业的历史信息记录，包括历史股东、历史对外投资、历史法律诉讼等。该节点支持时间轴展示、分类筛选和数据导出等功能，帮助用户了解企业的历史发展轨迹。

## 🎯 设计目标

### 业务目标
- 历史数据覆盖：支持股东、投资、诉讼等各类历史数据
- 时间轴展示：按时间顺序展示历史记录
- 分类筛选：按数据类型分类展示历史信息
- 数据导出：支持历史数据的导出功能
- 趋势分析：提供历史数据的变化趋势

### 技术目标
- 配置驱动：通过配置控制数据类型和展示方式
- 时间轴渲染：高效的时间轴组件渲染
- 大数据处理：支持大量历史数据的加载和展示
- 性能优化：支持虚拟滚动和数据缓存

## 📋 配置结构

### 基础配置

包含节点标题、唯一标识、API接口、列配置和分页大小等基础信息。

### 特殊配置

| 配置项 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| `supportDataTypes` | array | 否 | - | 支持的历史数据类型 |
| `supportTimeFilter` | boolean | 否 | true | 是否支持时间筛选 |
| `supportCategoryFilter` | boolean | 否 | true | 是否支持分类筛选 |
| `supportTimelineView` | boolean | 否 | true | 是否支持时间轴视图 |
| `supportExport` | boolean | 否 | true | 是否支持数据导出 |
| `defaultViewType` | string | 否 | timeline | 默认视图类型 |

### 交互配置

| 配置项 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| `enableTimeRangeFilter` | boolean | 否 | true | 启用时间范围筛选 |
| `enableCategoryFilter` | boolean | 否 | true | 启用分类筛选 |
| `enableTimelineView` | boolean | 否 | true | 启用时间轴视图 |
| `enableListView` | boolean | 否 | true | 启用列表视图 |
| `enableChartView` | boolean | 否 | false | 启用图表视图 |
| `enableExport` | boolean | 否 | true | 启用导出功能 |

## 🏗️ 节点类型定义

### 历史数据类型

- 股东相关：历史股东、历史对外投资、历史股权变更
- 法律相关：历史法律诉讼、历史法院公告、历史被执行人、历史失信信息
- 经营相关：历史经营异常、历史行政处罚、历史动产抵押、历史股权出质
- 资质相关：历史资质许可、历史商标信息、历史专利信息
- 其他：历史分支机构、历史变更记录

### 数据状态

- ACTIVE：有效
- EXPIRED：已过期
- CANCELLED：已撤销
- REPLACED：已替换
- OTHER：其他

### 视图类型

- TIMELINE：时间轴视图
- LIST：列表视图
- CHART：图表视图

## 🔧 配置示例

### 基础配置

包含标题、接口、列定义和分页设置的基础配置示例。

### 完整配置

包含特殊配置和交互配置的完整示例，支持多种数据类型、时间筛选和视图切换。

## 🎨 交互设计

### 时间轴视图

按时间顺序展示历史记录，支持缩放和拖动浏览不同时间段的历史数据。

### 列表视图

以表格形式展示历史记录，支持排序和筛选功能。

### 图表视图

以图表形式展示历史数据的变化趋势，支持多种图表类型。

### 筛选功能

支持时间范围筛选和分类筛选，帮助用户快速定位感兴趣的历史数据。
    "supportTimelineView": true,
    "supportExport": true,
    "defaultViewType": "timeline"
  },
  "interactionConfig": {
    "enableTimeRangeFilter": true,
    "enableCategoryFilter": true,
    "enableTimelineView": true,
    "enableListView": true,
    "enableChartView": true,
    "enableExport": true
  },
  "ajaxExtras": {
    "companycode": "{{companyCode}}"
  },
  "pageSize": 20
}
```

## 🎨 交互设计

### 视图切换

| 交互元素 | 位置 | 行为 | 说明 |
|----------|------|------|------|
| **视图切换器** | 顶部工具栏 | 按钮组 | timeline/list/chart |
| **时间轴视图** | 内容区域 | 垂直时间轴 | 按时间顺序展示 |
| **列表视图** | 内容区域 | 表格展示 | 传统表格形式 |
| **图表视图** | 内容区域 | 图表展示 | 趋势图、饼图等 |

### 时间筛选

| 交互元素 | 位置 | 行为 | 说明 |
|----------|------|------|------|
| **时间范围选择** | 顶部工具栏 | 日期选择器 | 选择起止时间 |
| **快速筛选** | 时间选择器旁 | 快捷选项 | 近1年/3年/5年/全部 |
| **时间粒度** | 筛选器旁 | 下拉选择 | 月/季/年 |

### 分类筛选

| 交互元素 | 位置 | 行为 | 说明 |
|----------|------|------|------|
| **数据类型** | 顶部工具栏 | 多选框 | 选择历史数据类型 |
| **全选/反选** | 类型选择器旁 | 按钮 | 快速选择 |
| **分类统计** | 筛选器下方 | 数字显示 | 显示各类数据数量 |

### 导出功能

| 交互元素 | 位置 | 行为 | 说明 |
|----------|------|------|------|
| **导出按钮** | 顶部工具栏 | 下拉菜单 | 选择导出格式 |
| **导出格式** | 导出菜单 | 单选 | Excel/CSV/PDF |
| **导出范围** | 导出对话框 | 选择 | 当前页/全部/筛选结果 |

## 📡 数据接口

### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `companycode` | string | 是 | 企业代码 |
| `dataTypes` | string[] | 否 | 历史数据类型筛选 |
| `startDate` | string | 否 | 开始时间 |
| `endDate` | string | 否 | 结束时间 |
| `viewType` | string | 否 | 视图类型 |
| `page` | number | 否 | 页码 |
| `pageSize` | number | 否 | 每页条数 |
| `exportFormat` | string | 否 | 导出格式 |

### 响应数据结构

响应数据包含状态码、消息和主体数据。主体数据包含历史数据总数、历史数据项列表、统计信息、时间轴数据、图表数据（可选）和导出URL（可选）。历史数据项包含ID、数据类型、内容、时间范围、状态、数据源、置信度、备注和相关数据。统计信息包含总数、按类型统计、按年统计、有效数量和过期数量。时间轴数据包含日期、数据项、数量和类型。图表数据包含趋势、分布和对比数据。相关数据包含ID、类型、标题和URL。

## ⚡ 性能优化

### 数据缓存策略

| 缓存类型 | 缓存键 | 有效期 | 说明 |
|----------|--------|--------|------|
| **配置缓存** | `config:history:${companyCode}` | 5分钟 | 缓存节点配置 |
| **数据缓存** | `data:history:${companyCode}:${params}` | 3分钟 | 缓存历史数据 |
| **统计缓存** | `stat:history:${companyCode}` | 10分钟 | 缓存统计数据 |
| **时间轴缓存** | `timeline:history:${companyCode}` | 5分钟 | 缓存时间轴数据 |
| **图表缓存** | `chart:history:${companyCode}` | 15分钟 | 缓存图表数据 |

### 分页优化

| 优化项 | 策略 | 说明 |
|--------|------|------|
| **虚拟滚动** | 数据量>100时启用 | 减少DOM节点数量 |
| **时间轴虚拟化** | 时间轴项目>200时启用 | 优化时间轴渲染 |
| **分页预加载** | 提前加载下一页 | 提升用户体验 |
| **增量加载** | 时间轴滚动加载 | 减少初始加载时间 |

### 渲染优化

| 优化项 | 策略 | 说明 |
|--------|------|------|
| **图表懒加载** | 视口内渲染 | 减少初始渲染量 |
| **时间轴懒加载** | 视口内渲染 | 提升滚动性能 |
| **数据分页** | 服务端分页 | 减少传输数据量 |
| **条件渲染** | 根据配置渲染 | 减少不必要的渲染 |

## 🛡️ 错误处理

### 业务错误

| 错误类型 | 错误码 | 处理策略 | 用户提示 |
|----------|--------|----------|----------|
| **无历史数据** | 404 | 显示空状态 | "暂无历史数据" |
| **时间范围错误** | 400 | 重置时间范围 | "时间范围错误，已重置" |
| **数据类型不存在** | 404 | 显示可用类型 | "该数据类型暂无数据" |
| **导出失败** | 500 | 重试导出 | "导出失败，请重试" |

### 系统错误

| 错误类型 | 处理策略 | 用户提示 |
|----------|----------|----------|
| **时间轴渲染失败** | 降级到列表视图 | "时间轴渲染失败，已切换到列表" |
| **图表渲染失败** | 隐藏图表视图 | "图表渲染失败，已隐藏图表" |
| **导出服务异常** | 禁用导出功能 | "导出服务异常，暂时不可用" |
| **大数据量超时** | 分页加载 | "数据量较大，已分页加载" |

## 📊 数据质量

### 数据可信度

| 置信度 | 标识 | 颜色 | 说明 |
|--------|------|------|------|
| **高(>90%)** | ● | 绿色 | 官方渠道数据 |
| **中(70%-90%)** | ● | 黄色 | 多渠道验证 |
| **低(<70%)** | ● | 红色 | 单一数据源 |

### 数据来源标识

| 数据源 | 标识 | 颜色 | 说明 |
|--------|------|------|------|
| **工商系统** | 工 | 绿色 | 工商登记信息 |
| **公示系统** | 公 | 蓝色 | 企业公示信息 |
| **司法系统** | 法 | 红色 | 法院公告信息 |
| **第三方** | 三 | 灰色 | 第三方数据 |

### 数据状态标识

| 数据状态 | 标识 | 颜色 | 说明 |
|----------|------|------|------|
| **有效** | ● | 绿色 | 当前有效数据 |
| **过期** | ● | 灰色 | 已过有效期 |
| **撤销** | ● | 红色 | 已被撤销 |
| **替换** | ● | 黄色 | 已被替换 |

## 🔧 扩展设计

### 功能扩展

| 扩展功能 | 配置项 | 说明 |
|----------|--------|------|
| **数据对比** | `enableDataCompare` | 支持历史数据对比 |
| **趋势预测** | `enableTrendForecast` | 基于历史数据预测趋势 |
| **异常检测** | `enableAnomalyDetection` | 检测历史数据异常 |
| **智能推荐** | `enableSmartRecommend` | 基于历史数据推荐 |

### 业务扩展

| 扩展业务 | 配置项 | 说明 |
|----------|--------|------|
| **行业历史对比** | `enableIndustryCompare` | 同行业历史数据对比 |
| **区域历史统计** | `enableRegionHistoryStats` | 区域历史数据统计 |
| **历史风险评估** | `enableHistoryRiskAssessment` | 基于历史数据评估风险 |
| **历史合规检查** | `enableHistoryComplianceCheck` | 历史合规性检查 |

## 📚 相关文档

- [节点设计规范](./node-design-spec.md) - 通用设计原则
- [配置消费机制](./config-consumption.md) - 配置消费流程
- [CompanyTable组件说明](../company-table.md) - 组件实现参考
- [企业详情页特殊节点配置说明](../special-node-config.md) - 特殊节点配置规范