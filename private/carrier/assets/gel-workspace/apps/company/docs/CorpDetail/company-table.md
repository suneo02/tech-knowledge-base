# CompanyTable组件说明

## 概述

`CompanyTable`是企业详情页的核心组件，负责消费节点配置并渲染相应的表格内容。每个节点配置对应一个`CompanyTable`实例，组件通过`eachTableKey`识别节点类型并应用相应的业务逻辑。

## 组件职责

| 职责 | 说明 |
|------|------|
| **配置消费** | 消费节点配置，渲染表格内容 |
| **节点识别** | 通过`eachTableKey`识别特殊节点类型 |
| **状态管理** | 维护特殊节点的业务状态 |
| **数据请求** | 根据配置发送数据请求 |
| **交互处理** | 处理筛选、分页、排序等交互 |

## 节点识别机制

组件通过`eachTableKey`识别特殊节点类型：

| 节点标识 | 节点类型 | 特殊处理 |
|----------|----------|----------|
| `showSharePenetration` | 股东穿透 | 支持穿透类型切换、比例筛选 |
| `showMainMemberInfo` | 实际控制人 | 支持多标签页、数据源切换 |
| `showCompanyChange` | 股东变更 | 支持变更前后对比、类型筛选 |
| `historycompany` | 历史数据 | 支持时间轴展示、分类筛选 |

## 配置消费流程

1. **配置获取**：从`corpModuleCfg`获取节点配置
2. **组件创建**：`CompanyBaseY`中调用`makeTable`创建实例
3. **配置传递**：将`eachTable`配置传递给组件
4. **内部处理**：根据配置渲染表格、处理数据请求

## 性能优化

### 数据加载优化

- **分页加载**：大数据量使用分页，每页默认10条
- **延迟加载**：非活跃标签页数据延迟加载
- **缓存机制**：相同参数结果在组件生命周期内缓存

### 渲染优化

- **虚拟滚动**：历史数据等长列表使用虚拟滚动
- **组件复用**：相同类型特殊节点组件实例复用
- **条件渲染**：根据权限和业务条件控制渲染

## 错误处理

### 业务异常处理

| 异常类型 | 处理方式 | 用户提示 |
|----------|----------|----------|
| **计算超时** | 显示部分结果 + 重试按钮 | "计算时间较长，请稍后重试" |
| **数据不完整** | 标识缺失数据 | "部分数据暂不可用" |
| **权限不足** | 显示VIP提示 | "需要升级权限查看完整数据" |

## 最佳实践

### 1. 配置设计

- 保持配置简洁，避免过度复杂的嵌套结构
- 使用标准的数据类型和格式
- 为特殊节点提供清晰的业务语义

### 2. 状态管理

- 特殊节点的业务状态独立管理
- 避免状态在组件间的不必要传递
- 及时清理过期状态

### 3. 错误处理

- 为不同错误类型提供明确的用户提示
- 实现优雅的错误恢复机制
- 记录错误日志便于排查

## 相关文档

- [企业详情页内容区域节点配置规范](./node-config-usage.md)
- [企业详情页特殊节点配置说明](./special-node-config.md)
- [企业详情页整体设计](./layout-middle.md)