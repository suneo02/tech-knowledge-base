# DOM 行分割问题与目标

> 📌 **文档关联**
> - 上一篇: [README](./README.md)
> - 下一篇: [DOM 行分割算法实现](./dom-based-row-algorithm-implementation.md)
> - 旧版文档: [DOM-based Row Splitting](./dom-based-row-splitting.md)

## 1.1. 现有问题

`splitForSingleLineFit` 函数负责分割因内容过多而无法在单行内完整显示的表格行。当前实现基于**纯文本长度**估算分割点，存在重大缺陷：
- **结构破坏**: 将 HTML 转换为纯文本进行测量，再将分割点映射回 HTML，此过程有损，极易破坏 HTML 标签的完整性。
- **预测不准**: 纯文本长度与渲染后的高度并非线性关系，尤其在富文本（如 `<b>`, `<span>`）场景下，预测非常不准。

## 1.2. 重构目标

核心目标是让分割过程**感知并尊重 HTML 结构**。
- **保证元素完整性**: 分割应优先发生在 HTML 元素**之间**，而非**之内**。
- **适配完整单元**: 每次迭代都尝试适配一个完整的 HTML 单元（如一个 `<span>` 标签或一个文本节点）。
- **优雅分割长文本**: 如果单个单元（如一段长文本）自身过大，则仅分割其内部文本，并保持其父标签包裹。
- **提高预测精度**: 直接使用部分 HTML 结构进行高度测试，实现更准确的高度预测。
- **保持 API 契约**: 保持输入/输出签名不变，最小化对调用方 `TableHandler` 的影响。