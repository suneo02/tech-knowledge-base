# æ¨¡æ¿ä½¿ç”¨å…¬å¸é€‰æ‹© - éœ€æ±‚ä¸æ–¹æ¡ˆè®¾è®¡

> ğŸ“– è¿”å› [ä»»åŠ¡æ¦‚è§ˆ](./README.md)

## éœ€æ±‚èƒŒæ™¯

ç”¨æˆ·åœ¨æ¨¡æ¿åˆ—è¡¨ä¸­ç‚¹å‡»"å¼€å§‹ä½¿ç”¨"æ—¶ï¼Œéœ€è¦é€‰æ‹©ä¸€ä¸ªå…¬å¸æ¥å…³è”ä½¿ç”¨è¯¥æ¨¡æ¿ã€‚å½“å‰å®ç°ç›´æ¥è·³è½¬ï¼Œç¼ºå°‘å…¬å¸é€‰æ‹©ç¯èŠ‚ï¼Œéœ€è¦è¡¥å……æ­¤äº¤äº’æµç¨‹ã€‚

## åŠŸèƒ½éœ€æ±‚

### ç”¨æˆ·åœºæ™¯

1. ç”¨æˆ·æµè§ˆæ¨¡æ¿åˆ—è¡¨ï¼Œæ‰¾åˆ°åˆé€‚çš„æ¨¡æ¿
2. ç‚¹å‡»"å¼€å§‹ä½¿ç”¨"æŒ‰é’®
3. å¼¹å‡ºå…¬å¸é€‰æ‹©å¼¹çª—
4. åœ¨å¼¹çª—ä¸­æœç´¢å¹¶é€‰æ‹©ç›®æ ‡å…¬å¸
5. ç‚¹å‡»ç¡®è®¤ï¼Œç³»ç»Ÿè°ƒç”¨æ¥å£åˆ›å»ºå…³è”
6. æˆåŠŸåè·³è½¬åˆ°æŠ¥å‘Šè¯¦æƒ…é¡µ

### åŠŸèƒ½è¦ç‚¹

- å¼¹çª—æ ‡é¢˜ï¼šä½¿ç”¨æ¨¡æ¿
- è¡¨å•å­—æ®µï¼šå…¬å¸åç§°ï¼ˆå¿…å¡«ï¼‰
- æœç´¢ç»„ä»¶ï¼šå¤ç”¨ `CorpPresearch` ç»„ä»¶
- ç¡®è®¤æŒ‰é’®ï¼šé€‰æ‹©å…¬å¸åå¯ç‚¹å‡»
- å–æ¶ˆæŒ‰é’®ï¼šå…³é—­å¼¹çª—

## æ–¹æ¡ˆè®¾è®¡

### äº¤äº’æµç¨‹

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant List as æ¨¡æ¿åˆ—è¡¨
    participant Modal as å…¬å¸é€‰æ‹©å¼¹çª—
    participant API as åç«¯æ¥å£

    User->>List: ç‚¹å‡»"å¼€å§‹ä½¿ç”¨"
    List->>Modal: æ‰“å¼€å¼¹çª—
    Modal->>User: æ˜¾ç¤ºå…¬å¸æœç´¢
    User->>Modal: æœç´¢å¹¶é€‰æ‹©å…¬å¸
    User->>Modal: ç‚¹å‡»ç¡®è®¤
    Modal->>API: è°ƒç”¨ report/template/use
    API-->>Modal: è¿”å›ç»“æœ
    Modal->>List: å…³é—­å¼¹çª—
    List->>User: è·³è½¬åˆ°æŠ¥å‘Šè¯¦æƒ…é¡µ
```

### ç»„ä»¶ç»“æ„

| ç»„ä»¶å±‚çº§      | è¯´æ˜                        |
| ------------- | --------------------------- |
| Modal         | å¼¹çª—å®¹å™¨ï¼Œæ§åˆ¶æ˜¾ç¤º/éšè—     |
| Form          | è¡¨å•å¸ƒå±€                    |
| CorpPresearch | å…¬å¸æœç´¢ç»„ä»¶ï¼Œauto æ¨¡å¼å•é€‰ |

### çŠ¶æ€ç®¡ç†

| çŠ¶æ€             | ç±»å‹               | è¯´æ˜             |
| ---------------- | ------------------ | ---------------- |
| useModalVisible  | boolean            | å¼¹çª—æ˜¾ç¤ºçŠ¶æ€     |
| selectedTemplate | ReportTemplateItem | å½“å‰é€‰ä¸­çš„æ¨¡æ¿   |
| selectedCorpId   | string             | é€‰ä¸­çš„å…¬å¸ ID    |
| selectedCorpName | string             | é€‰ä¸­çš„å…¬å¸åç§°   |
| confirmLoading   | boolean            | ç¡®è®¤æŒ‰é’®åŠ è½½çŠ¶æ€ |

### API æ¥å£

**æ¥å£è·¯å¾„**ï¼š`report/template/use`  
**å®šä¹‰ä½ç½®**ï¼š`@see packages/gel-api/src/chat/report/template.ts:24-29`

| å‚æ•°       | ç±»å‹   | è¯´æ˜               |
| ---------- | ------ | ------------------ |
| templateId | number | æ¨¡æ¿ ID            |
| entityCode | string | å…¬å¸ä»£ç ï¼ˆcorpIdï¼‰ |
| entityType | 1      | å®ä½“ç±»å‹ï¼Œå›ºå®šä¸º 1 |

### å…³é”®å®ç°ç‚¹

1. **çŠ¶æ€ç®¡ç†**ï¼šæ–°å¢å¼¹çª—ç›¸å…³çŠ¶æ€ï¼Œç®¡ç†æ¨¡æ¿å’Œå…¬å¸é€‰æ‹©
2. **CorpPresearch é›†æˆ**ï¼šç›‘å¬ onChange å›è°ƒè·å–å…¬å¸ä¿¡æ¯
3. **æŒ‰é’®é€»è¾‘è°ƒæ•´**ï¼šå°†"å¼€å§‹ä½¿ç”¨"ä»ç›´æ¥è·³è½¬æ”¹ä¸ºæ‰“å¼€å¼¹çª—
4. **API è°ƒç”¨**ï¼šç¡®è®¤æ—¶è°ƒç”¨ `report/template/use` æ¥å£
5. **é”™è¯¯å¤„ç†**ï¼šAPI å¤±è´¥æ—¶å‹å¥½æç¤ºï¼ŒæˆåŠŸåæ¸…ç©ºçŠ¶æ€å¹¶è·³è½¬

## æŠ€æœ¯çº¦æŸ

- ä½¿ç”¨ `@wind/wind-ui` çš„ Modal å’Œ Form ç»„ä»¶
- å¤ç”¨ `packages/gel-ui/src/biz/common/CorpPresearch` ç»„ä»¶
- API è°ƒç”¨ä½¿ç”¨ `createChatRequest` æ–¹æ³•
- éµå¾ª [React è§„èŒƒ](../../../../../docs/rule/react-rule.md) å’Œ [TypeScript è§„èŒƒ](../../../../../docs/rule/typescript-rule.md)

## æ›´æ–°è®°å½•

| æ—¥æœŸ       | ä¿®æ”¹äºº | æ›´æ–°å†…å®¹           |
| ---------- | ------ | ------------------ |
| 2025-10-30 | Kiro   | å®Œæˆéœ€æ±‚ä¸æ–¹æ¡ˆè®¾è®¡ |
