# 需求与背景 - 章节标题悬停 AIGC 按钮

> 📖 [返回任务概览](./README.md) | 遵循 [Spec 文档编写规范](../../../../../docs/rule/doc-spec-rule.md)

## 背景与上下文

### 业务目标

在报告编辑器中提供快捷的章节级 AIGC 功能入口，提升用户使用 AI 生成内容的便捷性和体验。

**来源**：@see [AIGC 功能流程](../../ContentManagement/single-chapter-aigc-flow.md)

### 已有能力

- 报告编辑器基于 TinyMCE 实现
- 章节标题使用 h1-h6 标签，带有 `data-chapter-id` 属性标识
- 已有外部组件渲染系统 `useExternalComponentRenderer`

**来源**：@see [渲染架构设计](../../RPEditor/rendering-and-presentation-guide.md)

### 待解决问题

- 缺少直观的章节级 AIGC 功能入口
- 需要在不影响编辑器内部 DOM 的前提下实现悬停交互
- 需要精确的定位计算以适配 iframe 内的编辑器

## 需求提炼

### 核心功能

在报告编辑器中，当用户鼠标悬停在章节标题（h1-h6）时，在标题左侧显示一个 AI 生成按钮，用于触发与该章节相关的 AI 生成功能。

### 功能要求

| 需求项   | 说明                                               | 来源 |
| -------- | -------------------------------------------------- | ---- |
| 触发条件 | 鼠标悬停在章节标题元素（h1-h6）时展示按钮           | TODO |
| 显示位置 | 标题左侧固定距离，垂直居中对齐                     | TODO |
| 交互方式 | 悬停标题时显示；鼠标移向按钮仍保持展示，移出按钮即隐藏 | TODO |
| 按钮样式 | 渐变蓝色背景，"AI" 文字标识                        | TODO |
| 回调功能 | 点击按钮时触发 `onAIGCButtonClick(chapterId)` 回调 | TODO |

### 约束条件

- 不能修改 TinyMCE 编辑器内部 DOM 结构
- 需要支持多个编辑器实例隔离
- 需要支持亮色/暗色主题
- 需要支持响应式布局

### 布局约束

**编辑器布局**: 采用限宽居中布局，body 元素限制最大宽度并水平居中，左右两侧存在空白边距区域用于放置浮动按钮。

```
┌──────────────────────────────────────┐
│  左侧空白 │  body (限宽)  │ 右侧空白  │
│  [按钮]   │  第一章标题   │           │
│  [按钮]   │  第二章标题   │           │
└──────────────────────────────────────┘
```

**关键需求**: 鼠标悬停在标题元素上时展示按钮；鼠标沿标题左侧移动至按钮时需保持按钮可见，直至指针离开按钮区域。

**技术挑战**:

- 需要保证标题元素 hover 与按钮区域 hover 之间的状态衔接顺畅
- 按钮悬浮在编辑器正文之外，需确保定位与 iframe 偏移计算准确
- 仍需兼顾性能、节流与多实例场景

## 更新记录

| 日期       | 修改人 | 更新内容                                   |
| ---------- | ------ | ------------------------------------------ |
| 2025-11-XX | Codex  | 调整悬停需求，仅要求标题元素触发与按钮保持 |
| 2025-10-29 | Kiro   | 从主文档拆分需求与背景章节                 |

