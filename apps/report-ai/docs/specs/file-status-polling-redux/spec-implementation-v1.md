# æ–‡ä»¶çŠ¶æ€è½®è¯¢ä¸æ•°æ®ç»Ÿä¸€ç®¡ç† - å®æ–½æ‹†è§£ v1

> å›é“¾ï¼š[README.md](/apps/report-ai/docs/specs/file-status-polling-redux/README.md)  
> çŠ¶æ€ï¼šğŸš§ å¾…å®æ–½

## å®æ–½æ¦‚è§ˆ

é‡‡ç”¨æ¸è¿›å¼è¿ç§»ç­–ç•¥ï¼Œåˆ† 6 ä¸ªé˜¶æ®µå®æ–½ï¼Œæ¯ä¸ªé˜¶æ®µå¯ç‹¬ç«‹äº¤ä»˜å’ŒéªŒè¯ã€‚

## å®æ–½é˜¶æ®µ

### é˜¶æ®µ 1ï¼šåˆ›å»º filePolling Sliceï¼ˆ2 å¤©ï¼‰

**ç›®æ ‡**ï¼šåˆ›å»ºè½®è¯¢æœºåˆ¶çš„ Redux Slice

**äº¤ä»˜ç‰©**ï¼š

- `src/store/filePolling/` ç›®å½•åŠç›¸å…³æ–‡ä»¶
  - `slice.ts` - Redux Slice å®šä¹‰
  - `types.ts` - ç±»å‹å®šä¹‰
  - `selectors.ts` - Selectors
  - `index.ts` - ç»Ÿä¸€å¯¼å‡º

**æ ¸å¿ƒåŠŸèƒ½**ï¼šè®¢é˜…ç®¡ç†ã€æ–‡ä»¶çŠ¶æ€æ˜ å°„ã€è½®è¯¢çŠ¶æ€æ§åˆ¶ã€è‡ªåŠ¨å»é‡

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] Redux Slice é›†æˆåˆ°ä¸» store
- [ ] è®¢é˜…/å–æ¶ˆè®¢é˜…åŠŸèƒ½æ­£å¸¸
- [ ] Selectors è¿”å›æ­£ç¡®æ•°æ®
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%

---

### é˜¶æ®µ 2ï¼šåˆ›å»º files Sliceï¼ˆ3 å¤©ï¼‰

**ç›®æ ‡**ï¼šåˆ›å»ºæ–‡ä»¶æ•°æ®ç®¡ç†çš„ Redux Slice

**äº¤ä»˜ç‰©**ï¼š

- `src/store/files/` ç›®å½•åŠç›¸å…³æ–‡ä»¶
  - `slice.ts` - Redux Slice å®šä¹‰
  - `types.ts` - ç±»å‹å®šä¹‰
  - `selectors/` - åˆ†åœºæ™¯ Selectors
  - `reducers/` - åˆ†åœºæ™¯ Reducers
  - `index.ts` - ç»Ÿä¸€å¯¼å‡º

**æ ¸å¿ƒåŠŸèƒ½**ï¼šå¤§çº²/æŠ¥å‘Š/åˆ—è¡¨æ–‡ä»¶æ•°æ®ç®¡ç†ã€çŠ¶æ€åŒæ­¥æœºåˆ¶

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] Redux Slice é›†æˆåˆ°ä¸» store
- [ ] ä¸‰ç§åœºæ™¯æ•°æ®ç®¡ç†åŠŸèƒ½æ­£å¸¸
- [ ] çŠ¶æ€æ›´æ–°æ­£ç¡®åŒæ­¥
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%

---

### é˜¶æ®µ 3ï¼šå®ç°è½®è¯¢ä¸­é—´ä»¶ï¼ˆ3 å¤©ï¼‰

**ç›®æ ‡**ï¼šå®ç°è‡ªåŠ¨è½®è¯¢å’ŒçŠ¶æ€åŒæ­¥çš„ä¸­é—´ä»¶

**äº¤ä»˜ç‰©**ï¼š

- `src/store/filePolling/middleware.ts` - è½®è¯¢ä¸­é—´ä»¶
- `src/store/filePolling/pollingController.ts` - è½®è¯¢æ§åˆ¶å™¨
- `src/store/middleware/syncFileStatus.ts` - çŠ¶æ€åŒæ­¥ä¸­é—´ä»¶

**æ ¸å¿ƒåŠŸèƒ½**ï¼šç›‘å¬è®¢é˜…å˜åŒ–ã€è‡ªåŠ¨å¯åœè½®è¯¢ã€è°ƒç”¨åº•å±‚ APIã€çŠ¶æ€åŒæ­¥ã€é”™è¯¯å¤„ç†

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] è®¢é˜…å˜åŒ–æ—¶è‡ªåŠ¨å¯åœè½®è¯¢
- [ ] è½®è¯¢ç»“æœæ­£ç¡®æ›´æ–°åˆ° Redux
- [ ] çŠ¶æ€åŒæ­¥åˆ°æ‰€æœ‰åœºæ™¯
- [ ] é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶æ­£å¸¸
- [ ] é›†æˆæµ‹è¯•é€šè¿‡

**ä¾èµ–**ï¼šé˜¶æ®µ 1ã€2

---

### é˜¶æ®µ 4ï¼šå®ç° Hooksï¼ˆ2 å¤©ï¼‰

**ç›®æ ‡**ï¼šåˆ›å»ºé¢å‘é¡µé¢çš„ Hooks

**äº¤ä»˜ç‰©**ï¼š

- `src/hooks/filePolling/useFilePollingSubscription.ts`
- `src/hooks/fileData/useOutlineFiles.ts`
- `src/hooks/fileData/useFileListData.ts`
- `src/hooks/fileData/index.ts`

**æ ¸å¿ƒåŠŸèƒ½**ï¼šè½®è¯¢è®¢é˜…ã€æ–‡ä»¶æ•°æ®ç®¡ç†ã€è‡ªåŠ¨è®¢é˜…å’Œæ¸…ç†

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] Hooks å®ç°å®Œæˆ
- [ ] è‡ªåŠ¨è®¢é˜…å’Œæ¸…ç†æœºåˆ¶æ­£å¸¸
- [ ] Hook æµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] æ–‡æ¡£å’Œç¤ºä¾‹å®Œæ•´

**ä¾èµ–**ï¼šé˜¶æ®µ 1ã€2ã€3

---

### é˜¶æ®µ 5ï¼šè¿ç§»é¡µé¢ï¼ˆ7 å¤©ï¼‰

#### 5.1 è¿ç§» ReportDetail é¡µé¢ï¼ˆ2 å¤©ï¼‰

**è¿ç§»å†…å®¹**ï¼š

- æ›´æ–° `src/pages/ReportDetail/RightPanel/index.tsx`
- é€‚é… `src/store/reportContentStore/hooks/useReportFiles.ts`

**è¿ç§»æ­¥éª¤**ï¼š

1. å°† `reportContentStore.reportFiles` è¿ç§»åˆ° `files.reportFiles`
2. ç§»é™¤æ‰‹åŠ¨è½®è¯¢é€»è¾‘
3. æ›´æ–°ç›¸å…³ Selectors

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] é¡µé¢åŠŸèƒ½æ­£å¸¸
- [ ] æ–‡ä»¶çŠ¶æ€è½®è¯¢æ­£å¸¸
- [ ] E2E æµ‹è¯•é€šè¿‡

#### 5.2 è¿ç§» FileManagement é¡µé¢ï¼ˆ2 å¤©ï¼‰

**è¿ç§»å†…å®¹**ï¼š

- æ›´æ–° `src/pages/FileManagement/index.tsx`
- é‡æ„ `src/hooks/useFileList.ts`

**è¿ç§»æ­¥éª¤**ï¼š

1. ä½¿ç”¨ `useFileListData` æ›¿ä»£ `useFileList`
2. ç§»é™¤ Hook å†…éƒ¨è½®è¯¢é€»è¾‘
3. ä½¿ç”¨ Redux ç®¡ç†æ–‡ä»¶åˆ—è¡¨

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] é¡µé¢åŠŸèƒ½æ­£å¸¸
- [ ] æœç´¢ã€åˆ†é¡µåŠŸèƒ½æ­£å¸¸
- [ ] E2E æµ‹è¯•é€šè¿‡

#### 5.3 è¿ç§» ChatOutline é¡µé¢ï¼ˆ3 å¤©ï¼‰

**è¿ç§»å†…å®¹**ï¼š

- æ›´æ–° `src/pages/ChatOutline/index.tsx`
- æ›´æ–° `src/context/RPOutline.tsx`
- é‡æ„ `src/hooks/RPOutline/useOutlineFilePolling.ts`

**è¿ç§»æ­¥éª¤**ï¼š

1. ä½¿ç”¨ `useOutlineFiles` ç®¡ç†æ–‡ä»¶æ•°æ®
2. ä» Context ä¸­ç§»é™¤æ–‡ä»¶çŠ¶æ€ç®¡ç†
3. ç§»é™¤ `useOutlineFilePolling`

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] é¡µé¢åŠŸèƒ½æ­£å¸¸
- [ ] æ¶ˆæ¯ä¸­æ–‡ä»¶çŠ¶æ€æ­£å¸¸æ›´æ–°
- [ ] E2E æµ‹è¯•é€šè¿‡

**ä¾èµ–**ï¼šé˜¶æ®µ 4

---

### é˜¶æ®µ 6ï¼šæ¸…ç†æ—§ä»£ç ï¼ˆ1 å¤©ï¼‰

**ç›®æ ‡**ï¼šç§»é™¤ä¸å†ä½¿ç”¨çš„æ—§ä»£ç 

**æ¸…ç†å†…å®¹**ï¼š

- ç§»é™¤ `src/hooks/RPOutline/useOutlineFilePolling.ts`
- é‡æ„ `src/hooks/useFileList.ts` ä¸ºç®€å• wrapper
- ç®€åŒ– `src/context/RPOutline.tsx` æ–‡ä»¶çŠ¶æ€ç®¡ç†
- è¿ç§» `src/store/reportContentStore/reducers/reportFilesReducers.ts`

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] æ—§ä»£ç å·²ç§»é™¤æˆ–æ ‡è®°
- [ ] æ— å¼•ç”¨æ—§ä»£ç 
- [ ] æ–‡æ¡£å·²æ›´æ–°
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡

**ä¾èµ–**ï¼šé˜¶æ®µ 5

---

## æ€»ä½“æ—¶é—´è¡¨

| é˜¶æ®µ     | å†…å®¹                   | å·¥æ—¶      | ä¾èµ–    |
| -------- | ---------------------- | --------- | ------- |
| é˜¶æ®µ 1   | åˆ›å»º filePolling Slice | 2 å¤©      | -       |
| é˜¶æ®µ 2   | åˆ›å»º files Slice       | 3 å¤©      | -       |
| é˜¶æ®µ 3   | å®ç°è½®è¯¢ä¸­é—´ä»¶         | 3 å¤©      | 1, 2    |
| é˜¶æ®µ 4   | å®ç° Hooks             | 2 å¤©      | 1, 2, 3 |
| é˜¶æ®µ 5.1 | è¿ç§» ReportDetail      | 2 å¤©      | 4       |
| é˜¶æ®µ 5.2 | è¿ç§» FileManagement    | 2 å¤©      | 4       |
| é˜¶æ®µ 5.3 | è¿ç§» ChatOutline       | 3 å¤©      | 4       |
| é˜¶æ®µ 6   | æ¸…ç†æ—§ä»£ç              | 1 å¤©      | 5       |
| **æ€»è®¡** |                        | **18 å¤©** |         |

## é£é™©ä¸åº”å¯¹

| é£é™©                 | åº”å¯¹æªæ–½                              |
| -------------------- | ------------------------------------- |
| Context è¿ç§»å¤æ‚åº¦é«˜ | ä¿ç•™ Context ç»“æ„ï¼Œåªè¿ç§»æ–‡ä»¶æ•°æ®éƒ¨åˆ† |
| çŠ¶æ€åŒæ­¥å¯èƒ½ä¸ä¸€è‡´   | ä½¿ç”¨ä¸­é—´ä»¶ç»Ÿä¸€å¤„ç†ï¼Œæ·»åŠ ä¸€è‡´æ€§æ£€æŸ¥    |
| æ€§èƒ½å½±å“             | ä½¿ç”¨ createSelector ä¼˜åŒ–ï¼Œç²¾ç¡®è®¢é˜…    |

## å›æ»šæ–¹æ¡ˆ

æ¯ä¸ªé˜¶æ®µå¯ç‹¬ç«‹å›æ»šï¼š

- **é˜¶æ®µ 1-4**ï¼šæ–°ä»£ç æœªä½¿ç”¨ï¼Œç›´æ¥ç§»é™¤
- **é˜¶æ®µ 5**ï¼šä¿ç•™æ—§ä»£ç ï¼Œåˆ‡æ¢å›æ—§å®ç°
- **é˜¶æ®µ 6**ï¼šä»ç‰ˆæœ¬æ§åˆ¶æ¢å¤

## éªŒæ”¶æ£€æŸ¥æ¸…å•

### åŠŸèƒ½éªŒæ”¶

- [ ] æ‰€æœ‰é¡µé¢æ–‡ä»¶çŠ¶æ€è½®è¯¢æ­£å¸¸
- [ ] æ–‡ä»¶æ•°æ®åœ¨é¡µé¢é—´æ­£ç¡®å…±äº«
- [ ] é¡µé¢åˆ‡æ¢æ—¶çŠ¶æ€æ­£ç¡®æ¸…ç†
- [ ] é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶æ­£å¸¸

### æ€§èƒ½éªŒæ”¶

- [ ] ç›¸åŒæ–‡ä»¶ä¸é‡å¤è½®è¯¢
- [ ] é¡µé¢æ¸²æŸ“æ€§èƒ½æ— æ˜æ˜¾ä¸‹é™
- [ ] å†…å­˜ä½¿ç”¨æ— æ˜æ˜¾å¢åŠ 

### ä»£ç è´¨é‡éªŒæ”¶

- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] é›†æˆæµ‹è¯•è¦†ç›–æ ¸å¿ƒæµç¨‹
- [ ] E2E æµ‹è¯•è¦†ç›–ä¸»è¦é¡µé¢
- [ ] ä»£ç å®¡æŸ¥é€šè¿‡
- [ ] æ–‡æ¡£å®Œæ•´

## ç›¸å…³æ–‡æ¡£

- [è®¾è®¡æ–¹æ¡ˆ](/apps/report-ai/docs/specs/file-status-polling-redux/spec-design-v1.md)
- [README](/apps/report-ai/docs/specs/file-status-polling-redux/README.md)

## æ›´æ–°è®°å½•

| æ—¥æœŸ       | ä¿®æ”¹äºº | æ›´æ–°å†…å®¹       |
| ---------- | ------ | -------------- |
| 2024-11-19 | AI     | ç²¾ç®€ç‰ˆå®æ–½æ‹†è§£ |
