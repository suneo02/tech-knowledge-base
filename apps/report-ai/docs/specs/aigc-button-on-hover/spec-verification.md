# 验证与风险 - 章节标题悬停 AIGC 按钮

> 📖 [返回任务概览](./README.md) | 遵循 [Spec 文档编写规范](../../../../../docs/rule/spec-doc-rule.md)

## 测试策略

| 测试类型 | 覆盖范围             | 工具         | 参考规范                                                  |
| -------- | -------------------- | ------------ | --------------------------------------------------------- |
| 单元测试 | Hook 逻辑、状态管理  | Vitest       | @see [测试规范](../../../../../docs/rule/testing-rule.md) |
| 组件测试 | 按钮渲染、样式、交互 | Vitest + RTL | @see [测试规范](../../../../../docs/rule/testing-rule.md) |
| 集成测试 | 完整流程、多实例隔离 | Vitest       | @see [测试规范](../../../../../docs/rule/testing-rule.md) |
| 视觉测试 | 主题适配、响应式布局 | Storybook    | @see [测试规范](../../../../../docs/rule/testing-rule.md) |

## 监控指标

| 指标           | 目标值  | 监控方式        |
| -------------- | ------- | --------------- |
| 按钮显示延迟   | < 100ms | Performance API |
| 事件处理耗时   | < 16ms  | Performance API |
| 定位计算准确率 | 100%    | 视觉回归测试    |

## 已识别风险

| 风险                   | 影响 | 概率 | 应对方案                       | 状态 |
| ---------------------- | ---- | ---- | ------------------------------ | ---- |
| iframe 定位计算不准确  | 高   | 中   | 增加边界测试，提供手动偏移配置 | ✅   |
| 多实例内存泄漏         | 高   | 低   | 严格的清理逻辑，增加内存监控   | ✅   |
| 鼠标检测性能问题       | 中   | 低   | RAF 节流，必要时可降级 Map     | ✅   |
| TinyMCE 版本兼容性问题 | 中   | 低   | 锁定 TinyMCE 版本              | ⏸️   |

## 降级方案

| 场景       | 降级策略                       | 影响范围   |
| ---------- | ------------------------------ | ---------- |
| 定位失败   | 按钮不显示，编辑器功能正常     | 单个章节   |
| 内存泄漏   | 提供手动清理接口，重启编辑器   | 单个编辑器 |
| 性能问题   | 增加开关控制功能启用，默认关闭 | 全局配置   |
| 兼容性问题 | 检测版本，不支持则不启用       | 特定版本   |

## 回滚计划

1. **快速回滚**：通过功能开关立即禁用
2. **代码回滚**：新功能独立模块化，可快速移除
3. **数据回滚**：无数据变更，无需回滚

## 更新记录

| 日期       | 修改人 | 更新内容                 |
| ---------- | ------ | ------------------------ |
| 2025-11-05 | Kiro   | 简化风险项，聚焦核心风险 |
| 2025-11-XX | Codex  | 更新风险项，说明检测策略 |
| 2025-10-29 | Kiro   | 从主文档拆分验证与风险   |
