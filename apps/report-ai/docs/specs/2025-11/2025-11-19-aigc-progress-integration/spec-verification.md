# AIGC 消息进度接入 - 验收记录

> 📖 回链：[任务概览](./README.md) | 遵循 [Spec 文档编写规范](../../../../../docs/rule/doc-spec-rule.md)

## 验收用例

### 功能验收

#### UC-01: 进度信息正常展示

**前置条件**：

- 用户已登录
- 进入 RPOutline 聊天页面

**测试步骤**：

1. 输入一个需要生成大纲的问题（如"帮我生成一份市场分析报告大纲"）
2. 点击发送
3. 观察聊天界面

**预期结果**：

- [ ] 在 AI 回复区域看到进度条
- [ ] 进度条显示当前步骤名称（如"模板已确认"）
- [ ] 进度条显示百分比（如 25%）
- [ ] 进度条随时间更新
- [ ] 进度完成后，进度条消失，显示最终结果

**实际结果**：待测试

---

#### UC-02: 进度信息缺失时的容错

**前置条件**：

- 后端未返回 `reportProgress` 字段

**测试步骤**：

1. Mock 后端响应，移除 `reportProgress` 字段
2. 发送消息

**预期结果**：

- [ ] 不展示进度条
- [ ] 其他功能正常（子问题、AI 回复等）
- [ ] 无控制台错误

**实际结果**：待测试

---

#### UC-03: 多轮对话中的进度展示

**前置条件**：

- 已有历史对话记录

**测试步骤**：

1. 在已有对话中发送新消息
2. 观察进度展示

**预期结果**：

- [ ] 只有最新消息显示进度
- [ ] 历史消息不显示进度
- [ ] 进度信息不影响历史消息展示

**实际结果**：待测试

---

#### UC-04: 进度与子问题同时展示

**前置条件**：

- 后端同时返回子问题和进度信息

**测试步骤**：

1. 发送消息
2. 观察子问题和进度的展示顺序

**预期结果**：

- [ ] 先展示 AI Header
- [ ] 然后展示子问题列表
- [ ] 然后展示进度条
- [ ] 最后展示 AI 回复内容
- [ ] 展示顺序符合逻辑

**实际结果**：待测试

---

#### UC-05: 取消请求时的进度清理

**前置条件**：

- 正在展示进度

**测试步骤**：

1. 发送消息，等待进度展示
2. 点击取消按钮

**预期结果**：

- [ ] 进度条停止更新
- [ ] 进度消息被清除或标记为已取消
- [ ] 无内存泄漏
- [ ] 无控制台错误

**实际结果**：待测试

---

### 非功能验收

#### NF-01: 性能验证

**测试指标**：

- [ ] 进度更新不增加额外网络请求
- [ ] 进度更新不导致页面卡顿
- [ ] 内存占用无明显增长
- [ ] 轮询频率保持在 3 秒（与现有一致）

**测试方法**：

1. 使用 Chrome DevTools 监控网络请求
2. 使用 Performance 面板监控渲染性能
3. 使用 Memory 面板监控内存使用

**实际结果**：待测试

---

#### NF-02: 类型安全验证

**测试指标**：

- [ ] 无 TypeScript 编译错误
- [ ] 无 TypeScript 类型警告
- [ ] IDE 类型提示正常
- [ ] 类型定义完整且准确

**测试方法**：

1. 运行 `pnpm type-check`
2. 在 IDE 中检查类型提示
3. 尝试传入错误类型，验证类型检查

**实际结果**：待测试

---

#### NF-03: 代码质量验证

**测试指标**：

- [ ] 无 ESLint 错误
- [ ] 无 ESLint 警告
- [ ] 代码符合团队规范
- [ ] 测试覆盖率 > 80%

**测试方法**：

1. 运行 `pnpm lint`
2. 运行 `pnpm test --coverage`
3. 代码审查

**实际结果**：待测试

---

## 兼容性测试

### 浏览器兼容性

| 浏览器  | 版本   | 状态 | 备注 |
| ------- | ------ | ---- | ---- |
| Chrome  | 最新版 | 待测 | -    |
| Firefox | 最新版 | 待测 | -    |
| Safari  | 最新版 | 待测 | -    |
| Edge    | 最新版 | 待测 | -    |

### 设备兼容性

| 设备类型 | 分辨率    | 状态 | 备注 |
| -------- | --------- | ---- | ---- |
| 桌面端   | 1920x1080 | 待测 | -    |
| 桌面端   | 1366x768  | 待测 | -    |
| 平板     | 1024x768  | 待测 | -    |

---

## 回归测试

### 现有功能验证

| 功能模块   | 测试项               | 状态 | 备注 |
| ---------- | -------------------- | ---- | ---- |
| 子问题展示 | 子问题列表正常展示   | 待测 | -    |
| AI 回复    | AI 内容正常展示      | 待测 | -    |
| 建议展示   | RAG/DPU 建议正常展示 | 待测 | -    |
| 大纲编辑   | 大纲编辑器正常工作   | 待测 | -    |
| 取消请求   | 取消功能正常工作     | 待测 | -    |
| 重试功能   | 重试功能正常工作     | 待测 | -    |
| 文件上传   | 文件上传和展示正常   | 待测 | -    |

---

## 边界情况测试

### BC-01: 进度百分比边界值

**测试场景**：

- [ ] 进度为 0%
- [ ] 进度为 100%
- [ ] 进度为负数（异常情况）
- [ ] 进度超过 100%（异常情况）

**预期行为**：

- 0% 和 100% 正常展示
- 负数和超过 100% 的值进行容错处理（如限制在 0-100 范围内）

---

### BC-02: 步骤名称边界值

**测试场景**：

- [ ] 步骤名称为空字符串
- [ ] 步骤名称很长（超过 50 字符）
- [ ] 步骤名称包含特殊字符

**预期行为**：

- 空字符串时显示默认文本或不显示
- 长文本自动截断或换行
- 特殊字符正确转义和显示

---

### BC-03: 网络异常情况

**测试场景**：

- [ ] 网络请求超时
- [ ] 网络请求失败
- [ ] 后端返回错误

**预期行为**：

- 进度停止更新
- 显示错误提示
- 不影响其他功能

---

## 性能基准

### 渲染性能

| 指标             | 目标值  | 实际值 | 状态 |
| ---------------- | ------- | ------ | ---- |
| 首次进度渲染时间 | < 100ms | 待测   | 待测 |
| 进度更新渲染时间 | < 50ms  | 待测   | 待测 |
| 内存占用增长     | < 5MB   | 待测   | 待测 |

### 网络性能

| 指标           | 目标值 | 实际值 | 状态 |
| -------------- | ------ | ------ | ---- |
| 额外网络请求数 | 0      | 待测   | 待测 |
| 轮询间隔       | 3s     | 待测   | 待测 |

---

## 验收结论

### 功能完整性

- [ ] 所有功能用例通过
- [ ] 所有非功能用例通过
- [ ] 所有边界情况处理正确
- [ ] 回归测试通过

### 代码质量

- [ ] 代码审查通过
- [ ] 测试覆盖率达标
- [ ] 无已知 Bug
- [ ] 文档完整

### 性能指标

- [ ] 渲染性能达标
- [ ] 网络性能达标
- [ ] 无性能回归

### 最终结论

**状态**：待验收

**验收人**：-

**验收时间**：-

**备注**：-

---

## 已知问题

| 问题 ID | 描述 | 严重程度 | 状态 | 备注 |
| ------- | ---- | -------- | ---- | ---- |
| -       | -    | -        | -    | -    |

---

## 改进建议

| 建议 ID | 描述 | 优先级 | 状态 | 备注 |
| ------- | ---- | ------ | ---- | ---- |
| -       | -    | -      | -    | -    |

---

## 更新记录

| 日期       | 修改人 | 更新内容                         |
| ---------- | ------ | -------------------------------- |
| 2025-11-12 | -      | 初始创建，定义验收用例和测试计划 |

## 相关文档

- [任务概览](./README.md)
- [需求与设计](./spec-core-v1.md)
- [实施计划](./spec-implementation.md)
- [测试规范](../../../../../docs/rule/code-testing-vitest-storybook-rule.md)

