# 章节标题删除后重新出现问题

> ✅ **已归档** | 解决时间：2025-02-14 | 严重程度：🔴 高

## 问题概览

| 字段     | 内容                                           |
| -------- | ---------------------------------------------- |
| 问题     | 用户删除章节标题文本后，标题重新出现且编号错误 |
| 状态     | ✅ 已解决                                      |
| 优先级   | 🔴 P0                                          |
| 责任人   | -                                              |
| 发现时间 | 2025-02-14                                     |
| 解决时间 | 2025-02-14                                     |

## 背景与预期

用户删除章节标题后，标题应该完全消失，不应该重新出现。

## 问题陈述

### 现象

用户删除章节标题文本后，等待几秒后标题重新出现，编号变成错误的值。

### 根因

保存时 `mergeChaptersWithDetected` 使用 `detected.title || chapter.title`，空标题回退到 Canonical 层的标题。

### 影响

- 用户无法删除章节标题
- 删除操作被自动撤销

## 关键参考

| 文档/代码路径                                  | 作用           | 备注             |
| ---------------------------------------------- | -------------- | ---------------- |
| `store/hooks/useReportContentPersistence.ts`   | 保存时数据处理 | 修改标题合并逻辑 |
| `domain/reportEditor/split/chapterSegments.ts` | 章节解析       | 正确处理空标题   |

## 解决方案

### 方案要点

1. 修改 `mergeChaptersWithDetected`，直接使用 `detected.title`（已完成）
2. 确保 `collectChapterSegments` 正确处理空标题（已完成）
3. Outline 选择器优先读取 Draft Tree（已完成）

### 待办事项

- [x] 修改标题合并逻辑
- [x] 验证空标题正确保存
- [x] 验证 Hydration 机制正常

## 验证与风险

### 验证步骤

1. 删除章节标题文本
2. 等待自动保存
3. 验证标题不会重新出现

### 剩余风险

- 无，修复方案安全可靠

## 更新日志

| 日期       | 事件 | 描述                         |
| ---------- | ---- | ---------------------------- |
| 2025-02-14 | 解决 | 修改标题合并逻辑，保留空标题 |

## 附录

修复要点：

- 保存时直接使用解析结果，不回退到 Canonical 层
- 确保数据源一致性
- Hydration 机制只在必要时触发
