---
description: Link management standards and procedures for adding new links
globs: **/link/**/*.ts
---
# 链接管理规范

## 目录结构

```
src/handle/link/
  ├── config/           # 配置相关
  │   ├── constant.ts   # 常量定义
  │   └── index.ts      # 配置导出
  ├── handle/           # 核心处理逻辑
  │   ├── common.ts     # 通用链接处理
  │   ├── jump.ts       # 跳转逻辑
  │   └── generateOverall.ts  # 链接生成
  ├── module/           # 模块定义
  │   ├── linksModule.ts # 模块枚举
  │   └── [module]/     # 具体模块实现
  ├── out/              # 外部链接
  └── terminal/         # 终端相关
```

## 核心概念

1. **链接模块 (LinksModule)**

- 每个链接必须属于一个模块类型
- 模块类型统一在 `linksModule.ts` 中定义
- 参考示例:

```typescript
export enum LinksModule {
  COMPANY = 1,
  GROUP = 2,
  CHARACTER = 3,
  // ...
}
```

2. **链接生成**

- 使用 `getUrlByLinkModule` 统一生成链接
- 支持不同环境(terminal/web/local)
- 支持参数配置和类型检查

3. **链接跳转**

- 使用 `handleJumpTerminalCompatibleAndCheckPermission` 处理跳转
- 自动识别终端命令和普通链接
- 支持百分终端特殊处理

4. **简单链接生成函数**

- 使用 `generateCommonLink` 生成


## 新增链接步骤

1. **定义模块类型**

```typescript
// src/handle/link/module/linksModule.ts
export enum LinksModule {
  // ... 现有模块
  NEW_MODULE = 'newModule'  // 添加新模块
}
```

2. **添加模块配置**

```typescript
// src/handle/link/config/index.ts
export const GelHashMap: Partial<Record<LinksModule, string>> = {
  // ... 现有配置
  [LinksModule.NEW_MODULE]: 'newModuleHash'
}
```

3. **实现链接生成逻辑**

- 在 `module/` 下创建对应模块文件
- 实现链接生成函数
- 在 `getUrlByLinkModule` 中添加处理逻辑
- 如果链接生成逻辑较为简单，调用 `generateCommonLink` 生成
- 如果链接生成逻辑较为复杂，在对应模块目录下创建文件，抽象为函数生成，底层最好也调用 `generateCommonLink` 生成

4. **页面测试验证**

- 在 `views/Dev/LinksPage` 中添加新链接的测试用例
- 验证不同环境下的链接生成和跳转

5. **单元测试**

- 

5. **链接使用示例**

```typescript
import { getUrlByLinkModule, LinksModule } from '@/handle/link'

const url = getUrlByLinkModule(LinksModule.NEW_MODULE, {
  id: 'xxx',
  params: { key: 'value' },
  env: 'web'
})
```

## 注意事项

1. **环境兼容**

- 确保链接在不同环境(terminal/web/local)下都能正常工作
- 使用 `getPrefixUrl` 处理不同环境的路径前缀

2. **终端命令**

- 终端命令格式: `!CommandParam[id,param1=value1,param2=value2]`
- 使用 `getIfTerminalCmd` 判断是否为终端命令

3. **类型安全**

- 使用 TypeScript 类型定义确保链接参数正确
- 为新增的模块添加相应的类型定义

4. **测试验证**

- 在 `views/Dev/LinksPage` 中添加新链接的测试用例
- 验证不同环境下的链接生成和跳转

@file src/handle/link/module/linksModule.ts
@file src/handle/link/config/index.ts
@file src/handle/link/handle/generateOverall.ts