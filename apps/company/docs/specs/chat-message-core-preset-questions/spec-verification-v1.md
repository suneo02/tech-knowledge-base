# ChatMessageCore 预设问句测试验证 v1

> [返回 README](./README.md) | 阶段：测试验证

## 元信息

| 字段       | 内容                                     |
| ---------- | ---------------------------------------- |
| 版本       | v1                                       |
| 最近更新   | 2025-10-29                               |
| 测试负责人 | 待分配                                   |
| 设计文档   | [spec-design-v1.md](./spec-design-v1.md) |

## 测试策略

| 层级     | 工具         | 覆盖范围                 | 目标覆盖率 |
| -------- | ------------ | ------------------------ | ---------- |
| 单元测试 | Vitest       | Hook 逻辑、工具函数      | ≥ 80%      |
| 组件测试 | Vitest + RTL | 组件渲染与交互           | ≥ 70%      |
| 集成测试 | Vitest       | ChatMessageCore 集成逻辑 | ≥ 60%      |
| 视觉测试 | Storybook    | 样式与主题适配           | 核心场景   |
| 手动测试 | 人工验收     | 端到端流程与边界场景     | 全场景     |

## 功能测试用例

### 场景 1：首次进入，无历史消息

- [ ] 在欢迎消息下方展示 3 条预设问句
- [ ] 问句内容随机且不重复
- [ ] 样式符合设计规范

### 场景 2：有历史消息，但用户未发言

- [ ] 在最后一条消息后展示预设问句
- [ ] 带有视觉分割线
- [ ] 点击后正常发送

### 场景 3：用户已发送过消息

- [ ] `isSentMsg` 状态更新为 `true`
- [ ] 预设问句区域隐藏
- [ ] 刷新页面后 `isSentMsg` 重置为 `false`

### 场景 4：点击发送流程

- [ ] 点击预设问句后 `isSentMsg` 立即设置为 `true`
- [ ] 消息成功发送到服务端
- [ ] 问句区域立即隐藏
- [ ] 消息列表滚动到底部

### 场景 5：网络异常

- [ ] 不抛出未捕获异常
- [ ] 不阻塞聊天主流程
- [ ] 错误日志正常记录

### 场景 6：数据为空

- [ ] 不展示预设问句区域
- [ ] 不影响其他功能

## 性能测试

| 指标         | 目标值     | 测试方法                    |
| ------------ | ---------- | --------------------------- |
| 接口响应时间 | < 200ms    | Network 面板 + 埋点监控     |
| 点击响应时间 | < 200ms    | Performance API             |
| 首屏渲染时间 | < 2s       | Lighthouse                  |
| 滚动帧率     | ≥ 60fps    | Chrome DevTools Performance |
| 内存占用     | 无明显波峰 | Memory Profiler             |

## 兼容性测试

### 浏览器兼容性

- [ ] Chrome 最新版
- [ ] Safari 最新版
- [ ] Firefox 最新版
- [ ] Edge 最新版

### 主题兼容性

- [ ] 浅色主题
- [ ] 深色主题

### 响应式适配

- [ ] 桌面端（≥ 1280px）
- [ ] 平板端（768px - 1279px）
- [ ] 移动端（< 768px）

## 监控与埋点

| 事件名                  | 触发时机     | 参数                                        |
| ----------------------- | ------------ | ------------------------------------------- |
| `preset_question_show`  | 问句区域展示 | `position`, `questionCount`                 |
| `preset_question_click` | 点击问句     | `questionId`, `questionContent`, `position` |
| `preset_question_send`  | 消息发送成功 | `questionId`, `success`, `duration`         |
| `preset_question_error` | 接口请求失败 | `errorCode`, `errorMessage`                 |

## 验收标准

### 功能验收

- [ ] 所有功能测试用例通过
- [ ] 无 P0/P1 级别 Bug
- [ ] 代码覆盖率达标

### 性能验收

- [ ] 所有性能指标达标
- [ ] 无明显性能退化
- [ ] 内存无泄漏

### 兼容性验收

- [ ] 主流浏览器兼容
- [ ] 深浅色主题正常
- [ ] 响应式布局正确

### 文档验收

- [ ] 代码注释完整
- [ ] COMPONENT.md 更新
- [ ] Storybook 示例完整

## 回归测试清单

- [ ] 首次进入展示问句
- [ ] 点击问句发送成功
- [ ] 聊天中问句隐藏
- [ ] 网络异常不崩溃
- [ ] 样式符合设计
- [ ] 性能指标达标

## 更新记录

| 日期       | 修改人  | 摘要                                 |
| ---------- | ------- | ------------------------------------ |
| 2025-10-29 | Kiro AI | 精简文档至 ~130 行，去除冗余代码示例 |
| 2025-10-29 | Kiro AI | 更新测试用例：Hook 重命名            |
| 2025-10-29 | Kiro AI | 修正测试用例：使用 isSentMsg         |
