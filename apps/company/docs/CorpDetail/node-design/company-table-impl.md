# CompanyTable技术实现

## 概述

本文档说明`CompanyTable`组件的技术实现细节，包括配置消费、特殊节点处理、状态管理、性能优化等核心功能。

## 组件定义

包含Props接口定义和基本组件结构，接收节点配置、标识、企业代码和模块标识等参数。

## 特殊节点识别

定义了特殊节点类型常量和识别逻辑，用于区分股东穿透、实际控制人、股东变更和历史数据等特殊节点。

## 状态管理实现

### 股东穿透状态

管理穿透类型、持股比例筛选和层级深度等状态。

### 实际控制人状态

管理活跃标签页和数据源选择状态。

### 股东变更状态

管理筛选类型和时间范围选择状态。

## 数据请求处理

### 标准数据请求

处理标准节点的数据请求，包括基础参数和分页参数。

### 特殊节点数据请求

根据不同节点类型添加特殊参数，如穿透类型、数据源、变更类型等，并对返回数据进行特殊处理。

## 性能优化实现

### 数据缓存

使用Map实现数据缓存，设置5分钟过期时间，减少重复请求。

### 虚拟滚动

对大数据量表格(超过100条)或历史数据节点使用虚拟滚动，提高渲染性能。

## 错误处理实现

### 数据加载错误

定义常见错误类型和对应提示信息，针对不同错误类型提供友好提示。

### 业务逻辑错误

处理业务逻辑中的异常情况，如穿透计算超时、数据格式错误等，根据节点类型显示不同的错误信息并提供降级方案。

## 特殊节点实现

### 股东穿透节点

实现穿透类型切换、比例筛选器和穿透结果表格的渲染，支持穿透类型、持股比例的动态调整和分页显示。

### 实际控制人节点

实现标签页切换和数据源切换功能，支持自然人股东、企业股东和控股企业三种视图的切换，并提供数据源选择功能。

## 使用示例

### 标准节点使用

使用基础信息节点配置，包含标题、接口、列定义和企业代码等参数，通过CompanyTable组件进行渲染。

### 特殊节点使用

使用股东穿透节点配置，包含穿透相关的列定义和层级参数，通过CompanyTable组件进行渲染。

## 最佳实践

### 1. 组件设计

- 保持单一职责，专注于表格渲染和数据处理
- 合理使用状态管理，避免过度复杂的嵌套状态
- 实现清晰的错误处理边界

### 2. 性能优化

- 合理使用数据缓存，避免重复请求
- 大数据量使用虚拟滚动或分页
- 及时清理过期状态和数据

### 3. 错误处理

- 为不同错误类型提供明确的用户提示
- 实现优雅的错误恢复机制
- 记录错误日志便于排查

## 相关文档

- [CompanyTable组件说明](../company-table.md)
- [企业详情页内容区域节点配置规范](../node-config-usage.md)
- [企业详情页特殊节点配置说明](../special-node-config.md)