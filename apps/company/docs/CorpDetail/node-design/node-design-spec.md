# 特殊节点设计规范

## 概述

本文档定义了企业详情页特殊节点的设计原则、配置规范和实现标准，确保节点设计的一致性、可维护性和扩展性。

## 🎯 设计原则

### 1. 配置驱动原则

| 原则 | 说明 | 示例 |
|------|------|------|
| **行为配置化** | 节点的行为通过配置定义 | `supportPenetrationType: true` |
| **展示配置化** | 节点的展示方式通过配置控制 | `showRatioFilter: true` |
| **数据配置化** | 数据获取参数通过配置传递 | `ajaxExtras: {level: 5}` |

### 2. 业务语义清晰

| 要求 | 说明 | 正例 | 反例 |
|------|------|------|------|
| **命名语义化** | 配置项名称体现业务含义 | `penetrationType` | `type` |
| **结构清晰** | 配置结构层次分明 | 按功能分组 | 扁平混杂 |
| **文档完整** | 每个配置项都有明确说明 | 必填注释 | 无说明 |

### 3. 扩展性设计

| 维度 | 设计要点 | 实现方式 |
|------|----------|----------|
| **功能扩展** | 预留扩展字段 | `extraConfig: {}` |
| **参数扩展** | 支持动态参数 | `dynamicParams: {}` |
| **展示扩展** | 支持多种展示模式 | `displayModes: []` |

## 🔧 配置结构规范

### 基础配置结构

基础配置包含节点标题、数据接口、列配置等基本信息，以及可选的提示信息、额外参数、分页大小和扩展字段。

### 特殊节点配置结构

特殊节点配置在基础配置之上扩展，包含特殊配置对象，该对象包含功能开关、业务参数和交互配置。交互配置包含筛选、排序和导出功能的开关。

## 📋 节点类型定义

### 股东穿透节点

| 配置项 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `supportPenetrationType` | boolean | 是 | 支持穿透类型切换 |
| `supportRatioFilter` | boolean | 是 | 支持比例筛选 |
| `maxLevel` | number | 是 | 最大穿透层级 |
| `defaultRatio` | number | 否 | 默认比例阈值 |

### 实际控制人节点

| 配置项 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `supportMultiTab` | boolean | 是 | 支持多标签页 |
| `supportDataSourceSwitch` | boolean | 是 | 支持数据源切换 |
| `tabTypes` | string[] | 是 | 标签页类型列表 |
| `dataSources` | string[] | 是 | 可选数据源列表 |

### 股东变更节点

| 配置项 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `supportChangeCompare` | boolean | 是 | 支持变更对比 |
| `supportTimeFilter` | boolean | 是 | 支持时间筛选 |
| `changeTypes` | string[] | 是 | 变更类型列表 |
| `dateRangeConfig` | object | 否 | 日期范围配置 |

### 历史数据节点

| 配置项 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `supportTimeline` | boolean | 是 | 支持时间轴展示 |
| `supportCategoryFilter` | boolean | 是 | 支持分类筛选 |
| `categories` | string[] | 是 | 数据分类列表 |
| `timelineConfig` | object | 否 | 时间轴配置 |

## ⚙️ 配置消费机制

### 1. 配置识别

通过节点映射表识别特殊节点类型，将节点标识符映射到对应的节点类型枚举，支持股东穿透、主要人员、企业变更和历史数据等节点类型。

### 2. 参数提取

从节点配置中提取特殊配置参数，用于后续的功能启用和业务逻辑处理。

### 3. 功能启用

根据特殊配置启用相应功能，如穿透类型切换、比例筛选等，返回启用的功能集合。

## 🎨 交互设计规范

### 1. 状态管理

| 状态类型 | 管理方式 | 更新机制 |
|----------|----------|----------|
| **业务状态** | React State | 用户交互触发 |
| **UI状态** | 组件内部State | 组件生命周期 |
| **缓存状态** | 内存缓存 | 定时清理 |

### 2. 事件处理

| 事件类型 | 处理原则 | 实现方式 |
|----------|----------|----------|
| **用户交互** | 即时响应 | 事件处理器 |
| **数据变更** | 异步处理 | Promise/async |
| **错误处理** | 友好提示 | 错误边界 |

### 3. 数据流

```
用户交互 → 状态更新 → 配置消费 → 数据请求 → 界面更新
```

## 🔍 验证规范

### 1. 配置验证

| 验证项 | 验证方式 | 错误处理 |
|--------|----------|----------|
| **必填字段** | 运行时检查 | 抛出错误 |
| **数据类型** | TypeScript类型 | 编译时检查 |
| **业务规则** | 自定义验证器 | 友好提示 |

### 2. 数据验证

| 验证项 | 验证时机 | 处理方式 |
|--------|----------|----------|
| **数据格式** | 接收到数据 | 格式化处理 |
| **数据完整性** | 渲染前 | 补充默认值 |
| **业务有效性** | 展示前 | 标识异常 |

## 📚 最佳实践

### 1. 配置设计

- 保持配置简洁，避免过度复杂的嵌套结构
- 使用标准的数据类型和格式
- 为特殊节点提供清晰的业务语义

### 2. 状态管理

- 特殊节点的业务状态独立管理
- 避免状态在组件间的不必要传递
- 及时清理过期状态

### 3. 错误处理

- 为不同错误类型提供明确的用户提示
- 实现优雅的错误恢复机制
- 记录错误日志便于排查

- ✅ **分层设计**：基础配置 + 特殊配置
- ✅ **语义命名**：使用业务术语命名
- ✅ **默认值**：为可选配置提供合理默认值
- ❌ **过度嵌套**：避免过深的配置层级
- ❌ **混合职责**：一个配置项只负责一个功能

### 2. 扩展策略

- ✅ **预留字段**：为未来功能预留配置空间
- ✅ **插件机制**：支持动态加载配置模块
- ✅ **版本管理**：支持配置版本升级
- ❌ **硬编码**：避免将业务逻辑硬编码在组件中
- ❌ **循环依赖**：配置之间避免循环引用

### 3. 性能考虑

- ✅ **按需加载**：配置按需加载，避免一次性加载所有配置
- ✅ **缓存策略**：合理缓存配置数据
- ✅ **懒初始化**：延迟初始化复杂配置
- ❌ **过度配置**：避免为简单功能提供复杂配置

## 🔗 相关文档

- [企业详情页内容区域节点配置规范](../node-config-usage.md)
- [CompanyTable组件说明](../company-table.md)
- [配置消费机制](./config-consumption.md)